[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\all_contents.txt] 
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\all_contents.txt] 

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\.vscode\settings.json] 
{
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\.env] 
PORT=5000
DATABASE_URL=postgresql://postgres:qazwsxedc@localhost:5432/auth_db
JWT_SECRET=supersecretkey
GEMINI_API_KEY=AIzaSyDYWMUnV57S-GlNM-0PDxtjHT1jdND-GyY
MONGO_URI=mongodb://localhost:27017/signature_finale
RESEND_API_KEY=re_fRdQGJ3j_MR4jx8RW7EzPKQgwSs3NncDh
EMAIL_USER=gaurav.jain@rodicconsultants.com
EMAIL_PASS=Illgsm@1316
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\server.js] 
import dotenv from "dotenv";
dotenv.config();
import express from "express";
import cors from "cors";
import bodyParser from "body-parser";
import {connectDB} from "./src/db.js";
import workflowRoutes from "./src/routes/workflow.route.js"
import authRoutes from "./src/routes/auth.route.js";
import uploadRoutes from "./src/routes/upload.route.js"
import summarizeRoutes from "./src/routes/summarize.route.js"
import jwt from "jsonwebtoken";
import auth from "./src/middlewares/auth.middleware.js";

const app = express();

app.use(express.json());
app.use(cors({
    origin: 'http://localhost:5173', 
    methods: ['GET', 'POST'],
    allowedHeaders: ['Content-Type', 'Authorization'],
    exposedHeaders: ['Content-Range', 'Accept-Ranges', 'Content-Length']
}));
app.use('/uploads', express.static('uploads'))

app.use(bodyParser.json());

app.get('/api/get-user',auth, (req, res) => {
  return res.send(req.user)
})

//Routes
app.use("/api/auth", authRoutes);
app.use("/api/upload", uploadRoutes);
app.use('/api/esign', workflowRoutes)
app.use('/api/summarize', summarizeRoutes)


connectDB();
app.listen(process.env.PORT, () =>
  console.log("Server running on port", process.env.PORT)
);
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\connectDB.js] 
import mongoose from "mongoose"

mongoose.connect('mongodb://127.0.0.1:27017/signature_finale')
.then(()=>console.log("connected to the DB."))
.catch((err)=>console.log("connection error ->", err))

const signerSchema = new mongoose.Schema({
    name:String,
    email:String,
    seq:Number,
    status:{type: String, default:'pending'}
})

const workFlowSchema = new mongoose.Schema({
    title:{type:String, default:"new signature request"},
    signers:[signerSchema],
    createdAt:{type:Date, default: Date.now}
})

const workFlow = new mongoose.model('Workflow', workFlowSchema)

export default workFlow
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\db.js] 
import dotenv from "dotenv";
dotenv.config(); 
import mongoose from "mongoose";


import pkg from "pg";
const { Pool } = pkg;

console.log("DATABASE_URL =", process.env.DATABASE_URL);

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});


pool.query("SELECT 1")
  .then(() => console.log("PostgreSQL connected successfully"))
  .catch((err) => {
    console.error("PostgreSQL connection failed");
    console.error(err.message);
  });



  const connectDB = async () => {
    try {
        await mongoose.connect('mongodb://127.0.0.1:27017/signature_finale');
        console.log("âœ… Connected to the mongoose DB.");
    } catch (err) {
        console.error("âŒ Connection error ->", err);
        process.exit(1); // Stop the app if the DB fails
    }
  };

export {pool, connectDB};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\config\mailer.js] 
import nodemailer from "nodemailer";
import dotenv from "dotenv";

dotenv.config();

const transporter = nodemailer.createTransport({
    host: "smtp.office365.com",
    port: 587,
    secure: false, 
    auth: {
        user: process.env.EMAIL_USER, 
        pass: process.env.EMAIL_PASS  
    },
    tls: {
        ciphers: 'SSLv3',
        rejectUnauthorized: false 
    }
});

// Verify connection
transporter.verify((error, success) => {
    if (error) {
        console.log("âŒ Outlook Mailer Error:", error);
    } else {
        console.log("ðŸ“§ Outlook Mailer is ready");
    }
});

export default transporter;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\controllers\auth.controller.js] 
import bcrypt from "bcrypt";
import jwt from "jsonwebtoken";
import {pool} from "../db.js";
import dotenv from "dotenv"
import generateKeys from "../utils/generateKeyPair.util.js";
import {encryptPrivateKey} from "../utils/crypto.util.js"

dotenv.config()

export const signup = async (req, res) => {
  const { email, password, username } = req.body;

  if (!email || !password || !username) {
    return res.status(400).json({ message: "Missing fields" });
  }

  try {
    // Hash password
    const hashedPassword = await bcrypt.hash(password, 10);
    const keyPair = await generateKeys();

    const encryptedPrivateKey = encryptPrivateKey(keyPair.privateKey, password)

    // Create user
    const userResult = await pool.query(
      "INSERT INTO users (email, password, public_key, encrypted_private_key, username) VALUES ($1, $2, $3, $4, $5) RETURNING id, email, public_key",
      [email, hashedPassword, keyPair.publicKey,encryptedPrivateKey, username]
    );

    // Generate the public and private keys, and send them in the response.

    res.status(201).json({
      message: "Signup successful",
      publicKey: keyPair.publicKey,
    });

  } catch (err) {
    if (err.code === "23505") {
      return res.status(400).json({ message: "User already exists" });
    }

    console.error("Signup error:", err);
    res.status(500).json({ message: "Signup failed" });
  }
};


export const login = async (req, res) => {
  const { email, password } = req.body;

  const result = await pool.query(
    "SELECT * FROM users WHERE email=$1",
    [email]
  );
  
  if (result.rows.length === 0)
    return res.status(401).json({ message: "Invalid credentials" });
  console.log('we definitely reached here')

  const user = result.rows[0];
  const match = await bcrypt.compare(password, user.password);

  if (!match)
    return res.status(401).json({ message: "Invalid credentials" });

  const token = jwt.sign(
    { id: user.id, email: user.email, username: user.username },
    process.env.JWT_SECRET,
    { expiresIn: "7d" }
  );


  res.json({ token });
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\controllers\signature.controller.js] 
import { pool } from "../db.js";
import { decryptPrivateKey } from "../utils/crypto.util.js";
import { signDocument } from "../utils/sign.util.js";
import crypto from "crypto";

export const signPdf = async (req, res) => {
  // Assuming req.user is populated by your JWT middleware
  const userId = req.user.id; 
  const { password } = req.body; 
  
  // Assuming you are using a package like 'multer' to handle PDF uploads
  const documentBuffer = req.file.buffer; 

  if (!password || !documentBuffer) {
    return res.status(400).json({ message: "Password and document are required." });
  }

  try {
    // 1. Fetch the user's encrypted private key from the database
    const userResult = await pool.query(
      "SELECT encrypted_private_key FROM users WHERE id = $1",
      [userId]
    );

    if (userResult.rows.length === 0) {
      return res.status(404).json({ message: "User not found" });
    }

    const { encrypted_private_key } = userResult.rows[0];

    // 2. Decrypt the private key using the provided password
    let decryptedBase64Key;
    try {
      decryptedBase64Key = decryptPrivateKey(encrypted_private_key, password);
    } catch (error) {
      // If decryption fails, it means they typed the wrong password
      return res.status(401).json({ message: "Invalid password for signing" });
    }

    // 3. Cryptographically sign the document
    const signatureBase64 = await signDocument(decryptedBase64Key, documentBuffer);

    // 4. (Optional but recommended) Calculate the document hash to store alongside the signature
    // This makes verifying the document later much easier.
    const documentHash = crypto.createHash('sha256').update(documentBuffer).digest('hex');

    // 5. Store the signature in the database
    await pool.query(
      "INSERT INTO signatures (user_id, document_hash, signature_value) VALUES ($1, $2, $3)",
      [userId, documentHash, signatureBase64]
    );

    // 6. Memory Cleanup (Crucial for security)
    decryptedBase64Key = null; 

    res.status(200).json({ 
      message: "Document signed successfully",
      signatureId: documentHash // Returning the hash as a reference
    });

  } catch (err) {
    console.error("Signing error:", err);
    res.status(500).json({ message: "Failed to sign document" });
  }
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\controllers\summarize.controller.js] 
import {pool} from "../db.js"
import PDFDocument from 'pdfkit';
import fs from 'fs';

const summarizeController = async (req, res) => {

    const { hash } = req.params;
    const apiKey = process.env.GEMINI_API_KEY;

    try {
        //  Get file from our database
        const result = await pool.query(
            'SELECT file_path, filename FROM documents WHERE file_hash = $1',
            [hash]
        );

        // If we don't have the file, return 'not found'
        if (result.rows.length === 0)
            return res.status(404).json({ error: 'Not found' });

        const { file_path, filename } = result.rows[0];
        const pdfBase64 = fs.readFileSync(file_path).toString("base64");

        // replace the timestamp from the pdf's name.
        const nameOnly = filename.replace(/-(\d+)(\.pdf)*$/i, "").replace(/\.pdf$/i, "");

        // console.log('nameonly->', nameOnly);


        const finalDownloadName = `Summary_${nameOnly}.pdf`;

        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

        // Prompt to get the PDF summary.
        const professionalPrompt = `
            Please provide a comprehensive and professional summary of the attached document. 
            Structure your response using the following format:
            
            1. **Executive Overview**: A 2-3 sentence high-level summary of the document's purpose.
            2. **Key Highlights**: Use bullet points to list the most critical facts, figures, or findings.
            3. **Conclusion/Action Items**: Summarize the final outcome or any next steps mentioned.
            
            Maintain a formal, objective tone. Use clear headings and ensure the information is condensed yet descriptive and preserves the original context.
        `;

        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{
                    parts: [
                        { text: professionalPrompt },
                        { inlineData: { mimeType: "application/pdf", data: pdfBase64 } }
                    ]
                }]
            })
        });

        const data = await response.json();

        if (!response.ok) {
            console.error("Gemini Error Detail:", data);
            return res.status(500).json({ error: "Gemini API rejected the request" });
        }

        const summaryText = data.candidates[0].content.parts[0].text;

        const doc = new PDFDocument({ margin: 50 });
        // console.log('final downlad name ---->', finalDownloadName)

        res.setHeader('Content-Type', 'application/pdf');
        res.setHeader('Content-Disposition', `attachment; filename="${finalDownloadName}"`);

        // Crucial: Expose the header so Axios can read it
        res.setHeader('Access-Control-Expose-Headers', 'Content-Disposition');

        // simply add the title "Summary Report"
        doc.pipe(res);
        doc.fillColor('#2563eb').fontSize(24).text(`Summary Report`, { underline: true });
        doc.moveDown(0.5);

        // Add the name of the original document.
        doc.fillColor('#4b5563').fontSize(12).text(`Document: ${nameOnly}`);

        // Add a horizontal line
        doc.moveTo(50, doc.y + 10)
            .lineTo(550, doc.y + 10)
            .strokeColor('#e5e7eb')
            .stroke();

        // Give some space before the summary starts
        doc.moveDown(2);

        const lines = summaryText.split('\n');

        lines.forEach(line => {
            let trimmedLine = line.trim();
            if (trimmedLine.length === 0) return;

            // 1. MAJOR HEADINGS (### or **Heading** or "1. Heading")
            if (trimmedLine.startsWith('###') || (trimmedLine.startsWith('**') && trimmedLine.endsWith('**')) || /^\d+\.\s/.test(trimmedLine)) {
                const cleanHeading = trimmedLine.replace(/[#\*]/g, '').trim();

                doc.moveDown(1);
                doc.fillColor('#000000')
                    .font('Helvetica-Bold') // Set Bold
                    .fontSize(14)
                    .text(cleanHeading);
                doc.moveDown(0.5);
                doc.font('Helvetica'); // Immediate reset to Regular
            }

            //  BULLET POINTS WITH BOLD LABELS
            else if (trimmedLine.startsWith('* ') || trimmedLine.startsWith('- ')) {
                const cleanLine = trimmedLine.replace(/^[\*\-]\s/, '').replace(/\*\*/g, '');
                const parts = cleanLine.split(':');

                if (parts.length > 1) {
                    const label = parts[0].trim() + ':';
                    const description = parts.slice(1).join(':').trim();

                    // Bold Label
                    doc.fillColor('#374151')
                        .font('Helvetica-Bold')
                        .fontSize(11)
                        .text(`â€¢ ${label}`, { indent: 20, continued: true });

                    // Regular Description
                    doc.font('Helvetica')
                        .text(` ${description}`, { lineGap: 5 });
                } else {
                    doc.fillColor('#374151')
                        .font('Helvetica')
                        .fontSize(11)
                        .text(`â€¢ ${cleanLine}`, { indent: 20, lineGap: 5 });
                }
            }

            // regular paragraphs
            else {
                const cleanText = trimmedLine.replace(/\*\*/g, '');
                doc.fillColor('#374151')
                    .font('Helvetica')
                    .fontSize(11)
                    .text(cleanText, { lineGap: 5, align: 'justify' });
            }
        });

        doc.end();

    } catch (error) {
        console.error("Critical Error:", error);
        res.status(500).json({ error: "Internal Server Error" });
    }
}

export default summarizeController
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\controllers\upload.controller.js] 
import {pool} from '../db.js';
import { generateFileHash } from '../utils/hash.util.js';

export const uploadPDF = async (req, res) => {
  if (!req.file) {
    return res.status(400).json({ error: 'No file provided' });
  }

  try {
    const fileHash = await generateFileHash(req.file.path);
    const { filename, path } = req.file;

    await pool.query(
      `INSERT INTO documents (file_hash, file_path, filename) 
       VALUES ($1, $2, $3) 
       ON CONFLICT (file_hash) DO NOTHING`, 
      [fileHash, path, filename]
    );

    res.status(200).json({
      message: 'Success',
      hash: fileHash,
      filename: req.file.filename
    });
  } catch (error) {
    res.status(500).json({ error: 'Hash calculation failed' });
  }
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\controllers\workflow.controller.js] 
import Workflow from "../models/workflow.model.js";
import { notifyNextAvailableSigners } from "../services/email.service.js";
import crypto from 'crypto';
import path from "path";
import fs from 'fs';
import { generateSignedPdfBuffer } from '../utils/pdf.util.js';

export const streamUpdatedPdf = async (req, res) => {
    try {
        const { workflowId } = req.params;
        const flow = await Workflow.findById(workflowId);

        if (!flow) return res.status(404).send("Document not found");

        // Generate the PDF buffer with the latest MongoDB data
        const pdfBuffer = await generateSignedPdfBuffer(flow.pdfPath, flow.signers, flow._id);

        res.contentType("application/pdf");
        res.send(Buffer.from(pdfBuffer));
    } catch (error) {
        res.status(500).send("Error rendering PDF");
    }
};


export const saveWorkflow = async (req, res) => {
    try {
        const file = req.file;
        if (!file) {
            return res.status(400).json({ message: "No PDF file received." });
        }

        //Recover data from FormData strings
        const title = file.originalname || "doc";
        const signers = JSON.parse(req.body.signers);

        const fileBuffer = fs.readFileSync(file.path);
        const pdfHash = crypto.createHash('sha256').update(fileBuffer).digest('hex');


        //Save to DB 
        const newFlow = new Workflow({
            title,
            pdfPath: file.path,
            pdfHash,
            signers
        });

        await newFlow.save();

        //Send the first email
        await notifyNextAvailableSigners(newFlow._id, 0);

        res.status(201).json({
            message: "Workflow initiated successfully!",
            id: newFlow._id,
            hash: pdfHash
        });
    } catch (error) {
        console.error("Save Workflow Error:", error);
        res.status(500).json({ error: error.message });
    }
};

export const signStep = async (req, res) => {
    try {
        const { workflowId, signerId, fieldsData } = req.body;
        const currentWorkflow = await Workflow.findById(workflowId);

        const signer = currentWorkflow.signers.id(signerId);
        if (!signer) return res.status(404).json({ message: "Signer not found" });

        if (fieldsData && fieldsData.length > 0) {
            fieldsData.forEach(data => {
                const field = signer.fields.find(f => f.id === data.fieldId);
                if (field) {
                    field.value = data.value;
                    field.color = data.color;
                    field.font = data.font;
                    if (data.type) field.type = data.type;
                }
            });
        }

        signer.status = 'completed';
        signer.signedAt = new Date();

        currentWorkflow.markModified('signers');

        // 1. SAVE THE WORKFLOW FIRST so the database knows this signer is 'completed'
        await currentWorkflow.save();

        // 2. CHECK IF OTHERS IN THE SAME STEP ARE PENDING
        const currentStep = signer.seq;
        const othersInStep = currentWorkflow.signers.filter(
            s => s.seq === currentStep && s.status !== 'completed'
        );

        // 3. IF EVERYONE IN THIS STEP IS DONE, TRIGGER THE NEXT EMAIL!
        if (othersInStep.length === 0) {
            console.log(`Step ${currentStep} completed. Triggering emails for the next sequence...`);
            await notifyNextAvailableSigners(workflowId, currentStep);
        }

        res.status(200).json({ message: "Signed successfully!" });
    } catch (error) {
        console.error("Sign Step Error:", error);
        res.status(500).json({ error: error.message });
    }
};


export const renderDocument = async (req, res) => {
    try {
        const { workflowId } = req.params;
        const flow = await Workflow.findById(workflowId);

        if (!flow) return res.status(404).send("Document not found");

        const pdfBuffer = await generateSignedPdfBuffer(flow.pdfPath, flow.signers,flow._id);

        res.contentType("application/pdf");
        res.send(Buffer.from(pdfBuffer));
    } catch (error) {
        console.error("âŒ CONTROLLER RENDER ERROR:", error);
        res.status(500).send("Error generating PDF");
    }
};


export const getWorkflowMeta = async (req, res) => {
    try {
        const { workflowId } = req.params;

        const flow = await Workflow.findById(workflowId);

        if (!flow) {
            return res.status(404).json({ message: "Document not found in DB" });
        }

        res.json(flow);
    } catch (err) {
        console.error("Database Error:", err);
        res.status(500).json({ error: "Server crashed while fetching workflow" });
    }
};

export const viewPdf = async (req, res) => {
    try {
        const workflow = await Workflow.findById(req.params.workflowId);

        if (!workflow) {
            return res.status(404).json({ message: "Workflow not found" });
        }

        const filePath = path.resolve(workflow.pdfPath);

        res.setHeader('Content-Type', 'application/pdf');
        res.setHeader('Access-Control-Allow-Origin', '*'); 
        res.sendFile(filePath);

        console.log('PDF Streamed successfully for:', workflow.title);
    } catch (error) {
        console.error("View PDF Error:", error);
        res.status(500).json({ message: "Could not stream PDF" });
    }
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\middlewares\auth.middleware.js] 
import jwt from "jsonwebtoken";

export default function auth(req, res, next) {
  try {
    // Expect: Authorization: Bearer <token>
    const authHeader = req.headers.authorization;
    if (!authHeader || !authHeader.startsWith("Bearer ")) {
      return res.status(401).json({ message: "Unauthorized" });
    }
  console.log("martin")
    
    // Get the token
    console.log(authHeader)
    const token = authHeader.split(" ")[1];
    
    // Verify token
    console.log('rajesh')
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    
    // Attach user info to request
    req.user = {
      id: decoded.id,
      username: decoded.username,
      email: decoded.email
    };
    console.log('ship-sheep-keep-beep')

    // console.log("onedirection",req.user)

    next();
  }
  catch (err) {
    return res.status(401).json({ message: "Invalid or expired token" });
  }
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\middlewares\upload.middleware.js] 
import multer from 'multer';
import path from 'path';
import fs from 'fs'

const storage = multer.diskStorage({
  destination: (req, file, cb) => {

    const dir = 'uploads/';
    if (!fs.existsSync(dir)) fs.mkdirSync(dir);
    cb(null, dir);
  },
  filename: (req, file, cb) => {
        // Professional naming: timestamp-originalName
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
        cb(null, uniqueSuffix + path.extname(file.originalname));
    }
});

const fileFilter = (req, file, cb) => {
  if (file.mimetype === 'application/pdf') {
    cb(null, true);
  } else {
    cb(new Error('Only PDF files are allowed!'), false);
  }
};

const upload = multer({
  storage,
  fileFilter,
  limits: { fileSize: 1024 * 1024 * 10 } // 10MB limit
});

export default upload
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\models\workflow.model.js] 
import mongoose from "mongoose";

// Define the exact shape of a Field 
const fieldSchema = new mongoose.Schema({
    id: { type: String, required: true }, // CRITICAL: Allows 'f-12345' string ID
    type: { type: String, required: true }, 
    x: { type: Number, required: true },
    y: { type: Number, required: true },
    width: { type: Number, required: true },
    height: { type: Number, required: true },
    page: { type: Number, default: 1 },
    required: { type: Boolean, default: true },
    // Data added during the signing phase:
    value: { type: String }, 
    color: { type: String }, 
    font: { type: String }
}, { _id: false }); // CRITICAL: Tells Mongoose NOT to overwrite our 'id' with an ObjectId

// the Signer
const signerSchema = new mongoose.Schema({
    name: String,
    email: String,
    seq: Number,
    status: { type: String, default: 'pending' },
    fields: [fieldSchema], // Embed the field schema here
    signedAt: { type: Date },
    ipAddress: String
});

//  the main Workflow
const workflowSchema = new mongoose.Schema({
    title: { type: String, required: true },
    pdfHash: { type: String, required: true, index: true }, 
    pdfPath: { type: String, required: true },
    signers: [signerSchema], 
    createdAt: { type: Date, default: Date.now }
});

const workflow = mongoose.model('Workflow', workflowSchema);

export default workflow;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\routes\auth.route.js] 
import express from "express";
import { signup, login } from "../controllers/auth.controller.js";
import authMiddleware from "../middlewares/auth.middleware.js";

const router = express.Router();

// Public routes
router.post("/signup", signup);
router.post("/login", login);

// Protected route
router.get("/me", authMiddleware, async (req, res) => {
  res.json({
    message: "You are authenticated",
    userId: req.user.id,
  });
});

export default router;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\routes\summarize.route.js] 
import express from "express"
import summarizeController from "../controllers/summarize.controller.js"

const router = express.Router()


router.get('/:hash', summarizeController)

export default router
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\routes\upload.route.js] 
import { Router } from 'express';
import  uploadMiddleware  from '../middlewares/upload.middleware.js';
import { uploadPDF } from '../controllers/upload.controller.js';

const router = Router();

router.post('/', uploadMiddleware.single('file'), uploadPDF);

export default router;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\routes\workflow.route.js] 
import express from 'express';
import  upload  from '../middlewares/upload.middleware.js';
import { saveWorkflow, signStep, streamUpdatedPdf,renderDocument, viewPdf, getWorkflowMeta } from '../controllers/workflow.controller.js';
import { signPdf } from '../controllers/signature.controller.js';
import verifyToken from '../middlewares/auth.middleware.js';

const router = express.Router();

router.post('/save-flow', upload.single('file'), saveWorkflow);
router.post('/sign-step', signStep);
router.post("/sign", verifyToken, upload.single("document"), signPdf);
router.get('/workflow/:workflowId', getWorkflowMeta);
router.get('/view-pdf/:workflowId', viewPdf);
router.get('/render-document/:workflowId', renderDocument);

export default router;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\services\email.service.js] 
import transporter from '../config/mailer.js';
import Workflow from '../models/workflow.model.js';

export const notifyNextAvailableSigners = async (workflowId, completedSeq) => {
    try {
        const workflow = await Workflow.findById(workflowId);
        if (!workflow) return;

        const targetSeq = completedSeq + 1;
        const signersToNotify = workflow.signers.filter(s => s.seq === targetSeq && s.status === 'pending');

        for (const signer of signersToNotify) {
            const signLink = `http://localhost:5173/sign/${workflowId}/${signer._id}`;
            
            const mailOptions = {
                from: `"Document Request" <${process.env.EMAIL_USER}>`,
                to: signer.email,
                subject: `Signature Requested: ${workflow.title}`,
                html: `
                    <div style="font-family: Arial, sans-serif; max-w: 600px; margin: 0 auto; color: #334155; line-height: 1.6;">
                        <p style="font-size: 16px;">Dear ${signer.name},</p>
                        
                        <p style="font-size: 15px;">I hope this email finds you well.</p>
                        
                        <p style="font-size: 15px;">
                            Please find the document titled <strong>"${workflow.title}"</strong>, which requires your review and signature.
                        </p>
                        
                        <p style="font-size: 15px;">
                            You can securely access and sign the document by clicking the button below:
                        </p>
                        
                        <div style="margin: 35px 0;">
                            <a href="${signLink}" style="background-color: #1e293b; color: #ffffff; padding: 12px 28px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 15px;">Review & Sign Document</a>
                        </div>
                        
                        <p style="font-size: 15px;">If you have any questions or concerns, please feel free to reach out.</p>
                        
                        <p style="font-size: 15px; margin-top: 30px;">
                            Best regards,<br>
                            <strong>The Rodic Team</strong>
                        </p>
                    </div>
                `
            };

            await transporter.sendMail(mailOptions);
            console.log(`âœ… Professional email sent to ${signer.email}`);
        }
    } catch (error) {
        console.error("âŒ Failed to trigger emails:", error);
    }
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\utils\crypto.util.js] 
import crypto from "crypto";

const ALGORITHM = "aes-256-gcm";
const ITERATIONS = 100000;
const KEY_LEN = 32; // 256 bits for AES-256
const DIGEST = "sha256";

export const encryptPrivateKey = (privateKeyString, password) => {
  // 1. Generate a random salt for key derivation
  const salt = crypto.randomBytes(16);
  
  // 2. Derive the Key Encryption Key (KEK) from the password
  const key = crypto.pbkdf2Sync(password, salt, ITERATIONS, KEY_LEN, DIGEST);
  
  // 3. Generate a random Initialization Vector (IV)
  const iv = crypto.randomBytes(12);
  
  // 4. Encrypt the private key
  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);
  let ciphertext = cipher.update(privateKeyString, 'utf8', 'hex');
  ciphertext += cipher.final('hex');
  
  // 5. Get the Authentication Tag (prevents tampering)
  const authTag = cipher.getAuthTag().toString('hex');
  
  // 6. Pack everything into a single string for Postgres
  // Format: salt:iv:authTag:ciphertext
  return `${salt.toString('hex')}:${iv.toString('hex')}:${authTag}:${ciphertext}`;
};

export const decryptPrivateKey = (encryptedData, password) => {
  // 1. Split the packed string back into components
  const parts = encryptedData.split(':');
  if (parts.length !== 4) throw new Error("Invalid encrypted data format");
  
  const [saltHex, ivHex, authTagHex, ciphertext] = parts;
  
  const salt = Buffer.from(saltHex, 'hex');
  const iv = Buffer.from(ivHex, 'hex');
  const authTag = Buffer.from(authTagHex, 'hex');
  
  // 2. Derive the exact same key using the stored salt
  const key = crypto.pbkdf2Sync(password, salt, ITERATIONS, KEY_LEN, DIGEST);
  
  // 3. Decrypt back to plaintext
  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);
  decipher.setAuthTag(authTag);
  
  let decrypted = decipher.update(ciphertext, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  
  return decrypted;
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\utils\generateKeyPair.util.js] 
import { webcrypto } from "crypto";
const { subtle } = webcrypto;

async function generateKeys() {
  const keyPair = await subtle.generateKey(
    {
      name: "ECDSA",
      namedCurve: "P-256",
    },
    true,
    ["sign", "verify"]
  );

  const publicKey = await subtle.exportKey("jwk", keyPair.publicKey);
  const privateKey = await subtle.exportKey("jwk", keyPair.privateKey);

  const private_b64Key = Buffer.from(JSON.stringify(privateKey)).toString('base64url');
  const public_b64Key = Buffer.from(JSON.stringify(publicKey)).toString('base64url');

  return {
    "privateKey":private_b64Key,
    "publicKey":public_b64Key,
    "obj":{publicKey, privateKey}
  }
}


export default generateKeys
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\utils\hash.util.js] 
import crypto from 'crypto';
import fs from 'fs';

export const generateFileHash = (filePath) => {
  return new Promise((resolve, reject) => {
    const hash = crypto.createHash('sha256');
    const stream = fs.createReadStream(filePath);

    stream.on('data', (data) => hash.update(data));
    stream.on('end', () => resolve(hash.digest('hex')));
    stream.on('error', (err) => reject(err));
  });
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\utils\pdf.util.js] 
import { PDFDocument, rgb, StandardFonts } from 'pdf-lib';
import fontkit from '@pdf-lib/fontkit';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export const generateSignedPdfBuffer = async (existingPdfPath, signers, envelopeId) => {
    try {
        console.log("-> Starting PDF Generation...");
        const absolutePath = path.resolve(existingPdfPath);
        const existingPdfBytes = fs.readFileSync(absolutePath);
        const pdfDoc = await PDFDocument.load(existingPdfBytes);

        pdfDoc.registerFontkit(fontkit);
        const standardFont = await pdfDoc.embedFont(StandardFonts.Helvetica);

        const pages = pdfDoc.getPages();
        const SCALE = 1.2;

        for (const signer of signers) {
            if (signer.status === 'completed' && signer.fields) {
                for (const field of signer.fields) {
                    if (!field.value) continue;

                    const pageIndex = (field.page || 1) - 1;
                    if (pageIndex >= pages.length) continue;
                    
                    const page = pages[pageIndex];
                    const { height } = page.getSize();

                    const pdfX = (field.x || 0) / SCALE;
                    const fieldHeightPdf = (field.height || 40) / SCALE;
                    const fieldWidthPdf = (field.width || 140) / SCALE;
                    const pdfY = height - ((field.y || 0) / SCALE) - fieldHeightPdf;
                    
                    try {
                        // ðŸ”¥ With the frontend update, ALL signatures arrive as perfectly rendered Images
                        if (String(field.value).startsWith('data:image')) {
                            const imgData = field.value.split(',')[1];
                            const imgBuffer = Buffer.from(imgData, 'base64');
                            const img = field.value.includes('image/png') 
                                ? await pdfDoc.embedPng(imgBuffer) 
                                : await pdfDoc.embedJpg(imgBuffer);
                            
                            const imgDims = img.scale(1);
                            
                            // Perfect aspect ratio scaling
                            const scaleFactor = Math.min(
                                fieldWidthPdf / imgDims.width, 
                                fieldHeightPdf / imgDims.height
                            );
                            
                            const finalWidth = imgDims.width * scaleFactor;
                            const finalHeight = imgDims.height * scaleFactor;
                            
                            // Perfect centering
                            const centerX = pdfX + (fieldWidthPdf - finalWidth) / 2;
                            const centerY = pdfY + (fieldHeightPdf - finalHeight) / 2;

                            page.drawImage(img, { x: centerX, y: centerY, width: finalWidth, height: finalHeight });

                        } else {
                            // Standard Text Fallback (for non-signature text fields)
                            let textColor = rgb(0, 0, 0);
                            if (field.color === '#000080') textColor = rgb(0, 0, 0.5);
                            else if (field.color === '#2563eb') textColor = rgb(0.14, 0.38, 0.92);
                            else if (field.color === '#1e293b') textColor = rgb(0.11, 0.16, 0.23);

                            const textToDraw = String(field.value).trim();
                            let fontSize = 12;
                            let textWidth = standardFont.widthOfTextAtSize(textToDraw, fontSize);
                            
                            while (textWidth > fieldWidthPdf - 6 && fontSize > 6) {
                                fontSize -= 1;
                                textWidth = standardFont.widthOfTextAtSize(textToDraw, fontSize);
                            }
                            
                            const textX = pdfX + (fieldWidthPdf - textWidth) / 2;
                            const textY = pdfY + (fieldHeightPdf / 2) - (fontSize / 3);

                            page.drawText(textToDraw, {
                                x: Math.max(pdfX, textX), 
                                y: textY,
                                size: fontSize,
                                font: standardFont,
                                color: textColor,
                            });
                        }
                    } catch (err) { 
                        console.error("Field draw error:", err.message); 
                    }
                }
            }
        }

        return await pdfDoc.save();
    } catch (error) {
        console.error("ðŸ”¥ FATAL GENERATION ERROR:", error);
        throw error;
    }
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\backend\src\utils\sign.util.js] 
import { webcrypto } from "crypto";
const { subtle } = webcrypto;

export const signDocument = async (base64urlPrivateKey, documentBuffer) => {
  // 1. Decode the base64url string back into a JWK string, then parse the JSON
  const jwkString = Buffer.from(base64urlPrivateKey, 'base64url').toString('utf8');
  const jwk = JSON.parse(jwkString);

  // 2. Import the key back into WebCrypto format
  const privateKey = await subtle.importKey(
    "jwk",
    jwk,
    { name: "ECDSA", namedCurve: "P-256" },
    true, // extractable
    ["sign"]
  );

  // 3. Sign the document. WebCrypto hashes the documentBuffer using SHA-256 automatically here.
  const signatureArrayBuffer = await subtle.sign(
    { name: "ECDSA", hash: { name: "SHA-256" } },
    privateKey,
    documentBuffer
  );

  // 4. Return the signature as a base64 string so it's easy to store in Postgres
  return Buffer.from(signatureArrayBuffer).toString('base64');
};
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\eslint.config.js] 
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\index.html] 
<!doctype html>
<html lang="en">

<head>
 <link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="icon" type="image/jpeg" href="/favicon.jpg" />

<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
  rel="stylesheet"
/>

  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link href="/src/style.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Editor</title>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\README.md] 
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\vite.config.js] 
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import tailwindcss from "@tailwindcss/vite";

export default defineConfig({
  plugins: [
    react(),
    tailwindcss(),
  ],
});

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\hooks\usePdfProcessor.js] 
import { PDFDocument, degrees, rgb, StandardFonts } from 'pdf-lib';
export const processPdf = async (pdfBuffer, watermarkUrl, settings, text) => {
  const pdfDoc = await PDFDocument.load(pdfBuffer);
  const pages = pdfDoc.getPages();
  const image = await pdfDoc.embedPng(watermarkUrl);

  pages.forEach((page) => {
    const { width: pageWidth, height: pageHeight } = page.getSize();
    const imgWidth = settings.scale * 65 * text.length;
    const imgHeight = settings.scale * 70;
    const rotationRad = (settings.rotation * Math.PI) / 180;
    
    let centerX = settings.position.includes('left') ? 10 + (imgWidth / 2) 
                : settings.position.includes('right') ? pageWidth - 10 - (imgWidth / 2) 
                : pageWidth / 2;
    let centerY = settings.position.includes('top') ? pageHeight - 10 - (imgHeight / 2) 
                : settings.position.includes('bottom') ? 10 + (imgHeight / 2) 
                : pageHeight / 2;

    // 1. Draw the image (this creates a new content stream at the end)
    page.drawImage(image, {
      x: centerX - (imgWidth / 2) * Math.cos(rotationRad) + (imgHeight / 2) * Math.sin(rotationRad),
      y: centerY - (imgWidth / 2) * Math.sin(rotationRad) - (imgHeight / 2) * Math.cos(rotationRad),
      width: imgWidth,
      height: imgHeight,
      rotate: degrees(settings.rotation),
      opacity: parseFloat(settings.opacity),
    });

    // 2. REORDER MANUALLY (The "Save the Rating" Logic)
    // We access the raw 'Contents' entry of the page node
    const contents = page.node.get(pdfDoc.context.obj('Contents'));
    
    // Check if it's an array (standard for pages with multiple streams)
    if (contents instanceof Array || (contents && contents.array)) {
      const array = contents instanceof Array ? contents : contents.array;
      if (array.length > 1) {
        // Pop the watermark stream we just added to the end
        const watermarkStream = array.pop();
        // Insert it at index 0 (the bottom layer)
        array.unshift(watermarkStream);
      }
    }
  });
  
    if (settings.flatten) {
    
      // Function for ultra-short, disruptive junk
      const getTinyJunk = () => {
        const chars = 'xo!$@.</z>!^%^z1mio#';
        return chars[Math.floor(Math.random() * chars.length)];
      };
    
      for (let y = 2; y < pageHeight; y += 6) {
    
        // Offset every other line to create a web of junk
        const offsetX = (y % 12 === 0) ? 0 : 15;
    
        // A 25px step is narrower than the average 5-letter word
        for (let x = offsetX; x < pageWidth; x += 25) {
          page.drawText(getTinyJunk(), {
            x: x + (Math.random() * 10), // Add "jitter" so it's not a perfect grid
            y: y,
            size: 4 + Math.random() * 3, // Tiny, but big enough to be captured
            font: font,
            color: rgb(1, 1, 1),
            opacity: 0.001,
          });
        }
      }
    }

  return await pdfDoc.save();
};


[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\public\favicon.svg] 
<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 512 512" xml:space="preserve">
<path style="fill:#E2E5E7;" d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z"/>
<path style="fill:#B0B7BD;" d="M384,128h96L352,0v96C352,113.6,366.4,128,384,128z"/>
<polygon style="fill:#CAD1D8;" points="480,224 384,128 480,128 "/>
<path style="fill:#F15642;" d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16
	V416z"/>
<g>
	<path style="fill:#FFFFFF;" d="M101.744,303.152c0-4.224,3.328-8.832,8.688-8.832h29.552c16.64,0,31.616,11.136,31.616,32.48
		c0,20.224-14.976,31.488-31.616,31.488h-21.36v16.896c0,5.632-3.584,8.816-8.192,8.816c-4.224,0-8.688-3.184-8.688-8.816V303.152z
		 M118.624,310.432v31.872h21.36c8.576,0,15.36-7.568,15.36-15.504c0-8.944-6.784-16.368-15.36-16.368H118.624z"/>
	<path style="fill:#FFFFFF;" d="M196.656,384c-4.224,0-8.832-2.304-8.832-7.92v-72.672c0-4.592,4.608-7.936,8.832-7.936h29.296
		c58.464,0,57.184,88.528,1.152,88.528H196.656z M204.72,311.088V368.4h21.232c34.544,0,36.08-57.312,0-57.312H204.72z"/>
	<path style="fill:#FFFFFF;" d="M303.872,312.112v20.336h32.624c4.608,0,9.216,4.608,9.216,9.072c0,4.224-4.608,7.68-9.216,7.68
		h-32.624v26.864c0,4.48-3.184,7.92-7.664,7.92c-5.632,0-9.072-3.44-9.072-7.92v-72.672c0-4.592,3.456-7.936,9.072-7.936h44.912
		c5.632,0,8.96,3.344,8.96,7.936c0,4.096-3.328,8.704-8.96,8.704h-37.248V312.112z"/>
</g>
<path style="fill:#CAD1D8;" d="M400,432H96v16h304c8.8,0,16-7.2,16-16v-16C416,424.8,408.8,432,400,432z"/>
</svg>
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\App.css] 
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


/* Ensure the parent has dimensions */
.flow-wrapper {
  height: 100vh;
  width: 100%;
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\App.jsx] 
import { Routes, Route, Navigate } from "react-router-dom";

import Login from "./pages/Login";
import Signup from "./pages/Signup";
import Dashboard from "./pages/Dashboard";
import Watermark from "./pages/Watermark";
import Esign from "./pages/Esign";
import Translate from "./pages/Translate";
import Summarize from "./pages/Summarize";
import Changefont from "./pages/Changefont";
import ScannedToStandard from "./pages/ScannedToStandard";
import ProtectedRoute from "./routes/ProtectedRoute";
import PublicRoute from "./routes/PublicRoute";
import ReceiptGenerator from "./pages/RecieptGenerator";
import SignPage from "./components/SignPage";
import TrackPage from "./components/TrackPage";


export default function App() {
  return (
    <Routes>

      {/* DEFAULT ROUTE */}
      <Route path="/" element={<Navigate to="/login" replace />} />

      {/* PUBLIC ROUTES */}
      <Route
        path="/login"
        element={
          <PublicRoute>
            <Login />
          </PublicRoute>
        }
      />

      <Route
        path="/signup"
        element={
          <PublicRoute>
            <Signup />
          </PublicRoute>
        }
      />

      {/* PROTECTED ROUTES */}
      <Route
        path="/dashboard"
        element={
          <ProtectedRoute>
            <Dashboard />
          </ProtectedRoute>
        }
      />


      <Route
        path="/watermark"
        element={
          <ProtectedRoute>
            <Watermark />
          </ProtectedRoute>
        }
      />

      <Route path="/sign/:workflowId/:signerId" element={

        <ProtectedRoute>

          <SignPage />
        </ProtectedRoute>
      } />

      <Route path="/track/:workflowId" element={

        <ProtectedRoute>

          <TrackPage />
        </ProtectedRoute>

      } />


      <Route
        path="/esign/"
        element={
          <ProtectedRoute>
            <Esign />
          </ProtectedRoute>
        }
      />



      <Route
        path="/translate"
        element={
          <ProtectedRoute>
            <Translate />
          </ProtectedRoute>
        }
      />

      <Route
        path="/summarize"
        element={
          <ProtectedRoute>
            <Summarize />
          </ProtectedRoute>
        }
      />
      <Route
        path="/change-font"
        element={
          <ProtectedRoute>
            <Changefont />
          </ProtectedRoute>
        }
      />
      <Route path="/scanned-to-standard" element={<ProtectedRoute>
        <ScannedToStandard />
      </ProtectedRoute>} />

      <Route path="/receipt-generator" element={<ProtectedRoute>
        <ReceiptGenerator />
      </ProtectedRoute>} />
    </Routes>
  );
}

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\index.css] 
@import "tailwindcss";

:root {
  font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;

  /* Font smoothing */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  /* Improve text rendering */
  text-rendering: optimizeLegibility;
}


/* ðŸ” Pretty scrollbar for private key textarea */
.pretty-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.pretty-scrollbar::-webkit-scrollbar-track {
  background: #18181b; /* zinc-900 */
  border-radius: 8px;
}

.pretty-scrollbar::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #6366f1, #4f46e5);
  border-radius: 8px;
}

.pretty-scrollbar::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #818cf8, #6366f1);
}

/* Firefox */
.pretty-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: #6366f1 #18181b;
}


/* Custom Scrollbar for the sidebar */
.custom-scrollbar::-webkit-scrollbar {
  width: 4px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #27272a; /* zinc-800 */
  border-radius: 10px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #3f3f46; /* zinc-700 */
}

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\main.jsx] 
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./App";
import "./index.css";

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\ProtectedRoute.jsx] 
import { Navigate } from "react-router-dom";

export default function ProtectedRoute({ children }) {
  const token = localStorage.getItem("token");

  if (!token) {
    return <Navigate to="/login" replace />;
  }

  return children;
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\api\axios.js] 
import axios from "axios";

const api = axios.create({
  baseURL: "http://localhost:5000/api",
});

api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("token");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

export default api;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\components\DraggableField.jsx] 
import React, { useRef, useState, useEffect } from 'react';
import Draggable from 'react-draggable';
import { X } from 'lucide-react';

const DraggableField = ({ field, color, isActive, onMove, onDelete }) => {
  const nodeRef = useRef(null);
  const [position, setPosition] = useState({ x: field.x, y: field.y });

  // Sync state if it changes externally
  useEffect(() => {
    setPosition({ x: field.x, y: field.y });
  }, [field.x, field.y]);

  return (
    <Draggable
      nodeRef={nodeRef}
      bounds="parent"
      position={position}
      onDrag={(e, data) => setPosition({ x: data.x, y: data.y })}
      onStop={(e, data) => onMove(field.id, data.x, data.y)}
      disabled={!isActive}
    >
      <div
        ref={nodeRef}
        className={`absolute pointer-events-auto group cursor-move flex flex-col items-center justify-center border-2 transition-all rounded-sm ${
          isActive ? 'shadow-xl ring-2 ring-white/50 z-50' : 'opacity-70 z-10'
        }`}
        style={{
          width: field.width,
          height: field.height,
          backgroundColor: `${color}33`,
          borderColor: color,
          top: 0,   // CRITICAL: Forces coordinate math to start from exact top-left
          left: 0,  // CRITICAL: Forces coordinate math to start from exact top-left
        }}
      >
        <div className="pointer-events-none flex flex-col items-center px-2 text-center">
          <span className="text-[9px] font-black uppercase tracking-tighter leading-tight" style={{ color }}>
            {field.type}
          </span>
          <span className="text-[7px] font-bold opacity-50 uppercase" style={{ color }}>PAGE {field.page}</span>
        </div>

        <button
          onClick={(e) => {
            e.stopPropagation();
            onDelete(field.id);
          }}
          className="absolute -top-2.5 -right-2.5 bg-red-500 text-white rounded-full p-1 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-[60]"
        >
          <X size={10} strokeWidth={3} />
        </button>
      </div>
    </Draggable>
  );
};

export default DraggableField;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\components\FeatureCard.jsx] 
export default function FeatureCard({ title, icon, description, onClick }) {
  return (
    <button
      onClick={onClick}
      className="
        bg-zinc-800 border border-zinc-700
        rounded-xl p-5 text-left
        hover:border-indigo-500 hover:bg-zinc-750
        transition
      "
    >
      <div className="text-3xl mb-3">{icon}</div>
      <h3 className="text-lg font-semibold mb-1">{title}</h3>
      <p className="text-sm text-zinc-400">{description}</p>
    </button>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\components\PlacementArena.jsx] 
import React, { useState, useRef } from 'react';
import { Document, Page, pdfjs } from 'react-pdf';
import { Type, PenTool, ArrowLeft } from 'lucide-react';
import DraggableField from './DraggableField';

import 'react-pdf/dist/Page/AnnotationLayer.css';
import 'react-pdf/dist/Page/TextLayer.css';
pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;

//  SLATE THEME PALETTE
const SIGNER_COLORS = ['#0e7490', '#be123c', '#047857', '#6d28d9', '#c2410c', '#1e293b', '#b91c1c', '#4338ca', '#a16207', '#15803d'];

const PlacementArena = ({ signers, setSigners, activeSignerIndex, setActiveSignerIndex, pdfFile, onBack, onSave, isSubmitting }) => {
  const [numPages, setNumPages] = useState(null);
  const [activePageNum, setActivePageNum] = useState(1);
  const scrollRef = useRef(null);

  const handleScroll = () => {
    if (!scrollRef.current) return;
    const pages = scrollRef.current.querySelectorAll('.pdf-page-wrapper');
    let closestPage = 1;
    let minDistance = Infinity;
    pages.forEach((page, idx) => {
      const rect = page.getBoundingClientRect();
      const distance = Math.abs(rect.top + rect.height / 2 - window.innerHeight / 2);
      if (distance < minDistance) {
        minDistance = distance;
        closestPage = idx + 1;
      }
    });
    setActivePageNum(closestPage);
  };

  //  THE SMART SPAWNER LOGIC
  const getSmartSpawnPosition = () => {
    const container = scrollRef.current;
    if (!container) return { page: 1, x: 50, y: 50 };

    const containerRect = container.getBoundingClientRect();
    const targetScreenY = containerRect.top + 150; // Aim for "Eye Level" (~150px down)
    
    const pages = container.querySelectorAll('.pdf-page-wrapper');

    for (let i = 0; i < pages.length; i++) {
      const pageRect = pages[i].getBoundingClientRect();
      
      // Is the target Y inside this page's vertical bounds?
      if (targetScreenY >= pageRect.top && targetScreenY <= pageRect.bottom) {
        let localY = targetScreenY - pageRect.top;
        return { 
            page: i + 1, 
            y: localY, 
            x: 80 // left indent
        };
      }
    }
    // Fallback if scrolling is weird
    return { page: activePageNum, x: 50, y: 50 };
  };

  const addField = (type) => {
    const activeSigner = signers[activeSignerIndex];
    if (activeSigner.fields?.some(f => f.type === type)) {
      alert(`This signer already has a ${type} placeholder.`);
      return;
    }

    // Get the coordinates
    const spawnCoords = getSmartSpawnPosition();

    const newField = {
      id: `f-${Date.now()}`,
      type,
      // ACTUALLY USE THE COORDINATES HERE!
      x: spawnCoords.x, 
      y: spawnCoords.y, 
      width: type === 'signature' ? 160 : 140,
      height: 45,
      page: spawnCoords.page, 
      required: true
    };

    setSigners(prev => prev.map((s, idx) =>
      idx === activeSignerIndex ? { ...s, fields: [...(s.fields || []), newField] } : s
    ));
  };

  const handleMove = (fieldId, newX, newY) => {
    setSigners(prev => prev.map(signer => ({
      ...signer,
      fields: signer.fields?.map(f => f.id === fieldId ? { ...f, x: newX, y: newY } : f)
    })));
  };

  const handleDelete = (fieldId) => {
    setSigners(prev => prev.map(signer => ({
      ...signer,
      fields: signer.fields?.filter(f => f.id !== fieldId)
    })));
  };

  return (
    <div className="flex h-screen w-screen bg-slate-100 overflow-hidden font-sans">
      
      {/* SIDEBAR */}
      <aside className="w-80 bg-white border-r border-slate-200 flex flex-col h-full shadow-xl z-50">
        <div className="p-6 border-b border-slate-100">
          <button onClick={onBack} className="text-xs font-bold text-slate-500 hover:text-slate-800 mb-4 flex items-center gap-1 uppercase tracking-widest transition-colors">
            <ArrowLeft size={14} /> Back
          </button>
          <h3 className="text-xl font-black text-slate-900 uppercase tracking-tight">Placement</h3>
          <div className="mt-2 px-3 py-1 bg-slate-100 text-slate-600 text-[10px] font-black rounded-md inline-block uppercase">
            Viewing Page: {activePageNum}
          </div>
        </div>

        <div className="flex-1 overflow-y-auto p-4 space-y-2 no-scrollbar bg-slate-50">
          {signers.map((s, idx) => (
            <div key={s.id} onClick={() => setActiveSignerIndex(idx)}
              className={`p-4 rounded-xl border-2 cursor-pointer transition-all ${activeSignerIndex === idx ? 'bg-white shadow-md border-slate-800 scale-[1.02]' : 'bg-transparent border-transparent opacity-60 hover:opacity-100 hover:bg-white'}`}>
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-full flex items-center justify-center text-[10px] font-bold text-white shadow-sm" style={{ backgroundColor: SIGNER_COLORS[idx % SIGNER_COLORS.length] }}>
                  {s.name ? s.name[0].toUpperCase() : idx + 1}
                </div>
                <p className="text-xs font-bold text-slate-700 truncate">{s.name || 'Recipient'}</p>
              </div>
            </div>
          ))}
        </div>

        <div className="p-6 border-t border-slate-100 bg-white space-y-4 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.05)]">
          <div className="grid grid-cols-2 gap-3">
            <button onClick={() => addField('signature')} className="flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-slate-100 hover:border-slate-800 hover:bg-slate-50 transition-all group">
              <PenTool size={20} className="text-slate-400 group-hover:text-slate-800 transition-colors" />
              <span className="text-[10px] font-bold text-slate-400 group-hover:text-slate-800 uppercase transition-colors">Signature</span>
            </button>
            <button onClick={() => addField('text')} className="flex flex-col items-center gap-2 p-4 rounded-xl border-2 border-slate-100 hover:border-slate-800 hover:bg-slate-50 transition-all group">
              <Type size={20} className="text-slate-400 group-hover:text-slate-800 transition-colors" />
              <span className="text-[10px] font-bold text-slate-400 group-hover:text-slate-800 uppercase transition-colors">Text Box</span>
            </button>
          </div>
          <button onClick={onSave} disabled={isSubmitting} className="w-full bg-slate-900 hover:bg-black text-white py-4 rounded-xl font-black text-xs uppercase tracking-widest shadow-xl shadow-slate-200 transition-transform active:scale-[0.98]">
            Send Request
          </button>
        </div>
      </aside>

      {/* MAIN PDF ARENA */}
      <main ref={scrollRef} onScroll={handleScroll} className="flex-1 overflow-y-auto bg-slate-200 p-12 no-scrollbar scroll-smooth">
        <Document file={pdfFile} onLoadSuccess={({ numPages }) => setNumPages(numPages)} className="flex flex-col items-center gap-10">
          {Array.from(new Array(numPages), (el, index) => (
            <div key={index} className="pdf-page-wrapper relative shadow-lg bg-white overflow-hidden ring-1 ring-black/5 w-fit mx-auto">
              <Page pageNumber={index + 1} renderTextLayer={false} renderAnnotationLayer={false} scale={1.2} />

              <div className="absolute inset-0 z-40 pointer-events-none">
                {signers.map((signer, sIdx) =>
                  signer.fields?.filter(f => f.page === index + 1).map(field => (
                    <DraggableField
                      key={field.id}
                      field={field}
                      color={SIGNER_COLORS[sIdx % SIGNER_COLORS.length]}
                      isActive={sIdx === activeSignerIndex}
                      onMove={handleMove}
                      onDelete={handleDelete}
                    />
                  ))
                )}
              </div>
            </div>
          ))}
        </Document>
      </main>
    </div>
  );
};

export default PlacementArena;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\components\SignPage.jsx] 
import React, { useState, useEffect, useMemo } from 'react';
import { useParams } from 'react-router-dom';
import { Document, Page, pdfjs } from 'react-pdf';
import axios from 'axios';
import { CheckCircle2, ShieldCheck, Upload, Check, ChevronDown, PenTool, Type, Download } from 'lucide-react';

import 'react-pdf/dist/Page/AnnotationLayer.css';
import 'react-pdf/dist/Page/TextLayer.css';

pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;

const getInitials = (name) => name ? name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : '.';
const API_BASE = 'http://localhost:5000/api';

const formatText = (text) => text ? String(text).trim().replace(/\s+/g, ' ').replace(/\s+([.,!?])/g, '$1') : '';

const calculatePreviewFontSize = (text, isSig) => {
  if (!text) return isSig ? '26px' : '12px';
  const charCount = formatText(text).length;
  if (isSig) {
    return charCount > 10 ? `${Math.max(14, 26 - (charCount - 10) * 1.5)}px` : '26px';
  }
  return charCount > 15 ? '10px' : '12px';
};

// ðŸ”¥ PRO MOVE: Canvas now dynamically matches the EXACT aspect ratio of the drop-zone
const generateFinalSignatureImage = async (config, tabMode, field) => {
  await document.fonts.ready;
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  // High-res multiplier for crisp PDF printing
  const scale = 4;
  const fieldWidth = field.width || 140;
  const fieldHeight = field.height || 40;

  // Canvas size matches the box perfectly
  canvas.width = fieldWidth * scale;
  canvas.height = fieldHeight * scale;

  let fontFamily = 'Pacifico';
  if (config.font === 'font-cursive-1') fontFamily = 'Dancing Script';
  if (config.font === 'font-cursive-3') fontFamily = 'Yellowtail';

  const dateStamp = new Date().toLocaleString('en-IN', {
    timeZone: 'Asia/Kolkata', day: '2-digit', month: '2-digit', year: 'numeric',
    hour: '2-digit', minute: '2-digit', hour12: true
  }).toLowerCase();

  ctx.fillStyle = config.color || '#1e293b';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';

  if (tabMode === 'type') {
    const text = formatText(config.text);
    // Dynamic font sizing: Name takes up ~55% of the box height
    let fontSize = fieldHeight * scale * 0.55; 
    ctx.font = `${fontSize}px "${fontFamily}"`;
    
    // Scale font down if the name is super long, so it never clips the edges
    while (ctx.measureText(text).width > canvas.width - (10 * scale) && fontSize > 10) {
        fontSize -= 2;
        ctx.font = `${fontSize}px "${fontFamily}"`;
    }
    // Center it vertically in the top half
    ctx.fillText(text, canvas.width / 2, canvas.height * 0.4);

  } else if (config.uploadedImg) {
    await new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => {
         const availableHeight = canvas.height * 0.65;
         const imgScale = Math.min((canvas.width - 20) / img.width, availableHeight / img.height);
         const w = img.width * imgScale;
         const h = img.height * imgScale;
         ctx.drawImage(img, (canvas.width - w) / 2, (canvas.height * 0.4) - (h / 2), w, h);
         resolve();
      };
      img.onerror = reject;
      img.src = config.uploadedImg;
    });
  }

  // Draw the Date dynamically sized (~25% of the box height) at the bottom
  ctx.font = `${fieldHeight * scale * 0.25}px "${fontFamily}"`;
  ctx.fillText(dateStamp, canvas.width / 2, canvas.height * 0.85);

  return canvas.toDataURL('image/png');
};

const SignPage = () => {
  const { workflowId, signerId } = useParams();

  const [workflowData, setWorkflowData] = useState({ workflow: null, pdfBlob: null, numPages: null });
  const [status, setStatus] = useState('loading');
  
  const [tab, setTab] = useState('type');
  const [signatureConfig, setSignatureConfig] = useState({
    text: "", color: "#1e293b", font: "font-cursive-2", uploadedImg: null
  });
  const [textValues, setTextValues] = useState({});

  const currentSigner = workflowData.workflow?.signers?.find(s => s._id === signerId);
  const groupedSteps = useMemo(() => {
    if (!workflowData.workflow?.signers) return [];
    const groups = workflowData.workflow.signers.reduce((acc, s) => {
      acc[s.seq] = acc[s.seq] || [];
      acc[s.seq].push(s);
      return acc;
    }, {});
    return Object.entries(groups).sort(([a], [b]) => Number(a) - Number(b));
  }, [workflowData.workflow]);

  useEffect(() => {
    if (!workflowId) return;
    const fetchWorkflowData = async () => {
      try {
        const [metaRes, pdfRes] = await Promise.all([
          axios.get(`${API_BASE}/esign/workflow/${workflowId}`),
          axios.get(`${API_BASE}/esign/view-pdf/${workflowId}`, { responseType: 'blob' })
        ]);
        setWorkflowData(prev => ({ ...prev, workflow: metaRes.data, pdfBlob: URL.createObjectURL(pdfRes.data) }));
        setStatus('idle');
      } catch (error) {
        setStatus('error');
      }
    };
    fetchWorkflowData();
  }, [workflowId]);

  const handleTextChange = (fieldId, val) => setTextValues(prev => ({ ...prev, [fieldId]: val }));

  const handleFileUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onloadend = () => setSignatureConfig(prev => ({ ...prev, uploadedImg: reader.result }));
    reader.readAsDataURL(file);
  };

  const handleDownload = async () => {
    try {
      setStatus('loading');
      const response = await axios.get(`${API_BASE}/esign/render-document/${workflowId}`, { responseType: 'blob' });
      const blob = new Blob([response.data], { type: 'application/pdf' });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', `Document_${workflowId.slice(-6)}.pdf`);
      document.body.appendChild(link);
      link.click();
      link.remove();
      window.URL.revokeObjectURL(url);
      setStatus('idle');
    } catch (error) {
      alert("Failed to download document.");
      setStatus('idle');
    }
  };

  const handleSignSubmit = async () => {
    const hasSigField = currentSigner?.fields?.some(f => ['signature', 'type', 'upload'].includes(f.type));
    if (hasSigField) {
      if (tab === 'type' && !signatureConfig.text.trim()) return alert("Please type your signature name.");
      if (tab === 'upload' && !signatureConfig.uploadedImg) return alert("Please upload your signature image.");
    }

    setStatus('loading');

    // ðŸ”¥ FIX: Generate a custom image mapped perfectly to EACH field's dimensions using Promise.all
    const fieldsData = await Promise.all(currentSigner.fields.map(async f => {
      if (['signature', 'type', 'upload'].includes(f.type)) {
        const finalSignaturePayload = await generateFinalSignatureImage(signatureConfig, tab, f);
        return { 
          fieldId: f.id, 
          value: finalSignaturePayload, 
          type: tab, 
          color: signatureConfig.color, 
          font: signatureConfig.font 
        };
      }
      return { fieldId: f.id, value: formatText(textValues[f.id]), type: 'text', color: '#1e293b', font: 'font-sans' };
    }));

    try {
      await axios.post(`${API_BASE}/esign/sign-step`, { workflowId, signerId, fieldsData });
      const metaRes = await axios.get(`${API_BASE}/esign/workflow/${workflowId}`);
      setWorkflowData(prev => ({ ...prev, workflow: metaRes.data }));
      setStatus('success');
    } catch (error) { 
      setStatus('error'); 
    }
  };

  const renderFieldBox = (field, isMe, isCompleted) => {
    const isSigField = ['signature', 'type', 'upload'].includes(field.type);
    let boxClasses = "absolute flex flex-col items-center justify-center overflow-visible pointer-events-none ";
    let content = null;

    const previewDateStamp = new Date().toLocaleString('en-IN', {
      timeZone: 'Asia/Kolkata', day: '2-digit', month: '2-digit', year: 'numeric',
      hour: '2-digit', minute: '2-digit', hour12: true
    }).toLowerCase();

    if (isCompleted || (isMe && status === 'success')) {
      boxClasses += "bg-transparent";
      if (String(field.value).startsWith('data:image')) {
        content = (
          <div className="flex flex-col items-center justify-center w-full h-full">
            <img src={field.value} className="max-h-full max-w-full object-contain mix-blend-multiply" alt="Signature" />
          </div>
        );
      } else {
        const displayText = formatText(field.value);
        const previewSize = calculatePreviewFontSize(displayText, isSigField);
        content = (
          <div className="flex flex-col items-center justify-center w-full h-full">
            <span className={`${field.font || 'font-sans'} px-2 text-center w-full whitespace-nowrap`} style={{ color: field.color || '#1e293b', fontSize: previewSize, lineHeight: 1 }}>{displayText}</span>
          </div>
        );
      }
    } else if (isMe && !isCompleted) {
      boxClasses += "bg-slate-200/50 border-2 border-slate-800 shadow-sm";
      if (isSigField) {
        if (tab === 'type') {
          const displayText = formatText(signatureConfig.text);
          const previewSize = calculatePreviewFontSize(displayText, true);
          content = displayText 
            ? (
              <div className="flex flex-col items-center justify-center w-full h-full">
                <span className={`${signatureConfig.font} px-2 text-center w-full whitespace-nowrap`} style={{ color: signatureConfig.color, fontSize: previewSize, lineHeight: 1 }}>{displayText}</span>
                <span className={`${signatureConfig.font} text-center whitespace-nowrap mt-1`} style={{ color: signatureConfig.color, fontSize: '10px', lineHeight: 1 }}>{previewDateStamp}</span>
              </div>
            )
            : <span className="font-sans font-bold text-slate-800 text-[10px] uppercase tracking-widest text-center w-full">Sign Here</span>;
        } else {
          content = signatureConfig.uploadedImg 
            ? (
              <div className="flex flex-col items-center justify-center w-full h-full">
                <img src={signatureConfig.uploadedImg} className="max-h-full max-w-full object-contain mix-blend-multiply" alt="preview" /> 
                <span className={`${signatureConfig.font} text-center whitespace-nowrap mt-1`} style={{ color: signatureConfig.color, fontSize: '10px', lineHeight: 1 }}>{previewDateStamp}</span>
              </div>
            )
            : <span className="font-sans font-bold text-slate-800 text-[10px] uppercase tracking-widest text-center w-full">Image Here</span>;
        }
      } else {
        const displayText = formatText(textValues[field.id]);
        const previewSize = calculatePreviewFontSize(displayText, false);
        content = displayText 
          ? <span className="font-sans font-medium text-black px-2 text-center w-full whitespace-nowrap" style={{ fontSize: previewSize, lineHeight: 1 }}>{displayText}</span> 
          : <span className="font-sans font-bold text-slate-800 text-[10px] uppercase tracking-widest text-center w-full">Text Here</span>;
      }
    } else if (!isMe && !isCompleted) {
      boxClasses += "bg-slate-50/80 border-2 border-dashed border-slate-300";
      content = (
        <div className="flex flex-col items-center justify-center w-full h-full text-center">
          <p className="font-sans font-bold text-slate-400 text-[8px] uppercase tracking-widest leading-tight px-1 truncate w-full">{field.signerName}</p>
          <p className="font-sans font-medium text-slate-400 text-[6px] uppercase leading-tight mt-0.5 w-full">({isSigField ? 'Signature' : 'Text Box'})</p>
        </div>
      );
    }

    return (
      <div key={field.id} className={boxClasses} style={{ left: field.x, top: field.y, width: field.width, height: field.height }}>
        {content}
      </div>
    );
  };

  return (
    <div className="flex h-screen w-screen bg-slate-900 overflow-hidden font-sans">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Yellowtail&display=swap');
        .font-cursive-1 { font-family: 'Dancing Script', cursive; font-weight: 400; font-kerning: none; }
        .font-cursive-2 { font-family: 'Pacifico', cursive; font-weight: 400; font-kerning: none; }
        .font-cursive-3 { font-family: 'Yellowtail', cursive; font-weight: 400; font-kerning: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
      `}</style>

      {/* LEFT: VIEWER */}
      <div className="flex-1 h-full overflow-y-auto p-12 no-scrollbar bg-slate-800 scroll-smooth">
        <Document 
          file={workflowData.pdfBlob} 
          onLoadSuccess={({ numPages }) => setWorkflowData(prev => ({ ...prev, numPages }))} 
          className="flex flex-col items-center gap-4"
        >
          {Array.from(new Array(workflowData.numPages), (el, index) => (
            <div key={index} className="relative shadow-2xl border-blue-800 bg-green-200 overflow-hidden ring-1 ring-black/5 w-fit mx-auto">
              <Page pageNumber={index + 1} renderTextLayer={false} renderAnnotationLayer={false} scale={1.2} />
              
              <div className="absolute inset-0 z-40 pointer-events-none">
                {workflowData.workflow?.signers?.map(signer => {
                  const isMe = signer._id === currentSigner?._id;
                  const isCompleted = signer.status === 'completed';

                  return signer.fields
                    ?.filter(f => f.page === index + 1)
                    .map(field => renderFieldBox({ ...field, signerName: signer.name }, isMe, isCompleted));
                })}
              </div>
            </div>
          ))}
        </Document>
      </div>

      {/* RIGHT: SIDEBAR */}
      <aside className="w-[450px] bg-white border-l border-slate-200 flex flex-col shadow-2xl z-50 relative">
        <header className="p-8 border-b border-slate-100 bg-white relative">
          <div className="w-12 h-12 bg-slate-100 text-slate-800 rounded-2xl flex items-center justify-center mb-5 shadow-sm">
            <ShieldCheck size={28} />
          </div>
          <h1 className="text-2xl font-black text-slate-900 tracking-tight leading-tight">Action Required</h1>
          <p className="text-slate-400 text-[10px] font-bold uppercase mt-2 tracking-widest">Doc ID: {workflowId.slice(-8)}</p>

          <button onClick={handleDownload} title="Download Document" className="absolute top-8 right-8 p-3 bg-slate-50 text-slate-400 hover:bg-slate-100 hover:text-slate-800 rounded-xl transition-all active:scale-95">
            <Download size={20} strokeWidth={2.5} />
          </button>
        </header>

        <div className="flex-1 overflow-y-auto no-scrollbar bg-slate-50">
          <div className="p-8 border-b border-slate-200 bg-white">
            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-8 text-center">Workflow Progress</h3>
            <div className="relative flex flex-col items-center">
              <div className="absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-[2px] bg-slate-200 z-0"></div>
              {groupedSteps.map(([seq, group], idx) => (
                <React.Fragment key={seq}>
                  <div className="w-full relative py-2 flex justify-center z-10">
                    <div className="flex gap-4">
                      {group.map((signer) => {
                        const isDone = signer.status === 'completed';
                        return (
                          <div key={signer._id} className="relative group cursor-default z-10 hover:z-[100]">
                            <div className="absolute bottom-full mb-3 left-1/2 -translate-x-1/2 px-3 py-2 bg-slate-800 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-200 pointer-events-none flex flex-col items-center shadow-xl w-max z-[100]">
                              <span className="text-[11px] font-bold">{signer.name}</span>
                              <span className="text-[9px] text-slate-300">{isDone ? 'Signed' : 'Pending'}</span>
                              <div className="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-r-[6px] border-t-[6px] border-transparent border-t-slate-800"></div>
                            </div>
                            <div className={`w-11 h-11 bg-white rounded-full flex items-center justify-center text-[11px] font-bold border-2 transition-all shadow-sm relative z-20 ${isDone ? 'border-slate-800 text-slate-800' : 'border-slate-300 text-slate-400'}`}>
                              {isDone ? <Check size={18} strokeWidth={3} /> : getInitials(signer.name)}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  {idx !== groupedSteps.length - 1 && (
                    <div className="w-full flex justify-center py-2 relative z-0 pointer-events-none">
                      <div className="bg-white p-1 rounded-full border-2 border-slate-100 text-slate-300">
                        <ChevronDown size={14} strokeWidth={3} />
                      </div>
                    </div>
                  )}
                </React.Fragment>
              ))}
            </div>
          </div>

          {currentSigner?.status !== 'completed' && status !== 'success' && (
            <div className="p-8 space-y-8 animate-in fade-in duration-500">
              {currentSigner?.fields?.filter(f => f.type === 'text').map((field, idx) => (
                <div key={field.id} className="space-y-3">
                  <label className="flex items-center gap-2 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                    <Type size={14} className="text-slate-500" /> Text Field {idx + 1}
                  </label>
                  <input 
                    className="w-full p-4 border-2 border-slate-200 rounded-xl text-sm outline-none focus:border-slate-800 transition-all bg-white shadow-sm font-medium" 
                    placeholder="Enter required text..." 
                    value={textValues[field.id] || ''} 
                    onChange={(e) => handleTextChange(field.id, e.target.value)} 
                  />
                </div>
              ))}

              {currentSigner?.fields?.some(f => ['signature', 'type', 'upload'].includes(f.type)) && (
                <div className="space-y-4">
                  <label className="flex items-center gap-2 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                    <PenTool size={14} className="text-slate-500" /> Signature
                  </label>
                  <div className="bg-white border-2 border-slate-200 rounded-2xl overflow-hidden shadow-sm">
                    <div className="flex border-b border-slate-100">
                      <button onClick={() => setTab('type')} className={`flex-1 py-4 font-black text-[10px] tracking-widest transition-colors ${tab === 'type' ? 'bg-slate-100 text-slate-800' : 'text-slate-400 hover:bg-slate-50'}`}>TYPE</button>
                      <button onClick={() => setTab('upload')} className={`flex-1 py-4 font-black text-[10px] tracking-widest transition-colors ${tab === 'upload' ? 'bg-slate-100 text-slate-800' : 'text-slate-400 hover:bg-slate-50'}`}>UPLOAD</button>
                    </div>
                    <div className="p-5 space-y-5">
                      {tab === 'type' ? (
                        <>
                          <input 
                            className="w-full p-4 border-2 border-slate-100 rounded-xl text-xl text-center outline-none focus:border-slate-800 transition-all font-medium bg-slate-50" 
                            placeholder="Your full name" 
                            value={signatureConfig.text} 
                            onChange={(e) => setSignatureConfig(prev => ({ ...prev, text: e.target.value }))} 
                          />
                          <div className="grid grid-cols-3 gap-2">
                            {['font-cursive-1', 'font-cursive-2', 'font-cursive-3'].map((f, i) => (
                              <button key={f} onClick={() => setSignatureConfig(prev => ({ ...prev, font: f }))} className={`p-3 border-2 rounded-xl text-lg transition-all ${f} ${signatureConfig.font === f ? 'bg-slate-800 border-slate-800 text-white shadow-md' : 'bg-white border-slate-100 text-slate-500 hover:border-slate-300'}`}>Style {i + 1}</button>
                            ))}
                          </div>
                          <div className="flex gap-4 justify-center items-center pt-2">
                            {['#1e293b', '#000080', '#2563eb'].map(c => (
                              <div key={c} onClick={() => setSignatureConfig(prev => ({ ...prev, color: c }))} className={`w-8 h-8 rounded-full cursor-pointer border-4 transition-transform ${signatureConfig.color === c ? 'border-slate-300 scale-110 shadow-sm' : 'border-transparent'}`} style={{ backgroundColor: c }} />
                            ))}
                          </div>
                        </>
                      ) : (
                        <div className="border-2 border-dashed border-slate-200 rounded-xl p-6 flex flex-col items-center justify-center relative hover:bg-slate-50 transition-all bg-white">
                          {signatureConfig.uploadedImg ? (
                            <img src={signatureConfig.uploadedImg} className="max-h-24 object-contain" alt="Uploaded signature" />
                          ) : (
                            <>
                              <Upload size={24} className="text-slate-300 mb-2" />
                              <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Select Image</p>
                            </>
                          )}
                          <input type="file" accept="image/*" className="absolute inset-0 opacity-0 cursor-pointer" onChange={handleFileUpload} />
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              )}
            </div>
          )}
        </div>

        <div className="p-8 bg-white border-t border-slate-200 z-10 shadow-[0_-10px_20px_-10px_rgba(0,0,0,0.05)]">
          {(currentSigner?.status === 'completed' || status === 'success') ? (
            <div className="text-center py-4 bg-green-50 rounded-2xl border border-green-100 animate-in zoom-in">
              <CheckCircle2 size={32} className="text-green-500 mx-auto mb-2" />
              <h2 className="text-sm font-black text-green-900 uppercase tracking-widest">Complete</h2>
              <p className="text-[10px] text-green-600 font-bold uppercase mt-1">Your signature is saved</p>
            </div>
          ) : (
            <button onClick={handleSignSubmit} disabled={status === 'loading'} className="w-full bg-slate-800 text-white py-5 rounded-[1.2rem] font-black text-xs uppercase tracking-widest shadow-xl shadow-slate-200 hover:bg-slate-900 active:scale-[0.98] transition-all flex items-center justify-center gap-3 disabled:bg-slate-400 disabled:shadow-none">
              {status === 'loading' ? 'Processing...' : <><Check size={20} strokeWidth={3} /> Adopt & Sign</>}
            </button>
          )}
        </div>
      </aside>
    </div>
  );
};

export default SignPage;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\components\TrackPage.jsx] 
import React, { useState, useEffect, useMemo } from 'react';
import { useParams } from 'react-router-dom';
import axios from 'axios';
import { CheckCircle2, ShieldCheck, Check, ChevronDown, Download, Clock } from 'lucide-react';

const getInitials = (name) => name ? name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : '.';

const TrackPage = () => {
  const { workflowId } = useParams();
  const [workflow, setWorkflow] = useState(null);
  const [status, setStatus] = useState('loading');

  useEffect(() => {
    const fetchWorkflowData = async () => {
      try {
        const metaRes = await axios.get(`http://localhost:5000/api/esign/workflow/${workflowId}`);
        setWorkflow(metaRes.data);
        setStatus('idle');
      } catch (err) { setStatus('error'); }
    };
    if (workflowId) {
      fetchWorkflowData();
      const interval = setInterval(fetchWorkflowData, 10000); 
      return () => clearInterval(interval);
    }
  }, [workflowId]);

  const groupedSteps = useMemo(() => {
    if (!workflow?.signers) return [];
    return Object.entries(
      workflow.signers.reduce((acc, s) => {
        if (!acc[s.seq]) acc[s.seq] = [];
        acc[s.seq].push(s);
        return acc;
      }, {})
    ).sort(([a], [b]) => Number(a) - Number(b));
  }, [workflow]);

  // ðŸ”¥ ROCK-SOLID DOWNLOAD LOGIC
  const handleDownload = async () => {
    try {
      setStatus('downloading');
      const response = await axios.get(`http://localhost:5000/api/render-document/${workflowId}`, { 
        responseType: 'blob' 
      });
      
      // Explicitly declare the Blob type
      const blob = new Blob([response.data], { type: 'application/pdf' });
      const url = window.URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', `${workflow.title.replace(/\s+/g, '_')}.pdf`);
      document.body.appendChild(link); // Required for Firefox
      link.click();
      link.parentNode.removeChild(link);
      window.URL.revokeObjectURL(url);
      
      setStatus('idle');
    } catch (error) {
      console.error("Download Error:", error);
      alert("Failed to download document.");
      setStatus('idle');
    }
  };

  if (!workflow) return <div className="h-screen flex items-center justify-center bg-slate-50 font-sans text-slate-500">Loading tracking data...</div>;

  const isFullyCompleted = workflow.signers.every(s => s.status === 'completed');

  return (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-8 font-sans">
      <div className="bg-white max-w-4xl w-full rounded-3xl shadow-xl overflow-hidden flex flex-col md:flex-row">
        
        {/* LEFT: STATUS OVERVIEW */}
        <div className="flex-1 p-12 flex flex-col justify-center border-r border-slate-100">
          <div className="w-16 h-16 bg-slate-100 text-slate-800 rounded-2xl flex items-center justify-center mb-6">
            {isFullyCompleted ? <ShieldCheck size={32} /> : <Clock size={32} />}
          </div>
          <h1 className="text-3xl font-black text-slate-900 tracking-tight leading-tight">{workflow.title}</h1>
          <p className="text-slate-500 text-sm mt-3 font-medium">Tracking ID: <span className="font-mono bg-slate-100 px-2 py-1 rounded text-xs">{workflowId}</span></p>
          
          <div className="mt-8 p-6 bg-slate-50 rounded-2xl border border-slate-200">
            <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Current Status</h3>
            {isFullyCompleted ? (
              <span className="inline-flex items-center gap-2 text-slate-800 font-bold bg-white border border-slate-200 px-3 py-1.5 rounded-lg shadow-sm">
                <CheckCircle2 size={16} /> Fully Executed
              </span>
            ) : (
              <span className="inline-flex items-center gap-2 text-slate-600 font-bold bg-white border border-slate-200 px-3 py-1.5 rounded-lg shadow-sm">
                <Clock size={16} /> Awaiting Signatures
              </span>
            )}
          </div>

          <button 
            onClick={handleDownload}
            disabled={status === 'downloading'}
            className="mt-8 w-full py-4 bg-slate-800 hover:bg-slate-900 text-white font-bold rounded-2xl flex justify-center items-center gap-3 transition-all active:scale-[0.98] shadow-lg disabled:opacity-70"
          >
            {status === 'downloading' ? 'Generating PDF...' : <><Download size={18} /> Download Document</>}
          </button>
        </div>

        {/* RIGHT: THE PROGRESS TREE (UNIFIED) */}
        <div className="w-full md:w-[350px] bg-slate-50 p-10 overflow-y-auto max-h-[600px] no-scrollbar">
          <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-8 text-center">Live Routing Order</h3>
          
          <div className="relative flex flex-col items-center">
            {/* The structural vertical line */}
            <div className="absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-[2px] bg-slate-200 z-0"></div>
            
            {groupedSteps.map(([seq, group], idx) => (
              <React.Fragment key={seq}>
                <div className="w-full relative py-2 flex justify-center z-10">
                  <div className="flex gap-4">
                    {group.map((signer) => {
                      const isDone = signer.status === 'completed';
                      return (
                        <div key={signer._id} className="relative group cursor-default z-10 hover:z-[100]">
                          
                          <div className="absolute bottom-full mb-3 left-1/2 -translate-x-1/2 px-3 py-2 bg-slate-800 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-200 pointer-events-none flex flex-col items-center shadow-xl w-max z-[100]">
                            <span className="text-[11px] font-bold">{signer.name}</span>
                            <span className="text-[9px] text-slate-300">{isDone ? 'Signed' : 'Pending'}</span>
                            <div className="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-r-[6px] border-t-[6px] border-transparent border-t-slate-800"></div>
                          </div>
                          
                          {/* The Signer Node */}
                          <div className={`w-11 h-11 bg-white rounded-full flex items-center justify-center text-[11px] font-bold border-2 transition-all shadow-sm relative z-20
                            ${isDone ? 'border-slate-800 text-slate-800' : 'border-slate-300 text-slate-400'}`}>
                            {isDone ? <Check size={18} strokeWidth={3} /> : getInitials(signer.name)}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
                
                {idx !== groupedSteps.length - 1 && (
                  <div className="w-full flex justify-center py-2 relative z-0 pointer-events-none">
                    <div className="bg-white p-1 rounded-full border-2 border-slate-100 text-slate-300">
                      <ChevronDown size={14} strokeWidth={3} />
                    </div>
                  </div>
                )}
              </React.Fragment>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default TrackPage;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\AllSignersPage.jsx] 
import React, { useState, useRef } from 'react';
import { Upload, ArrowLeft, ShieldCheck, Cpu, Hash, Key, CheckCircle2, Loader2, User, FileDown } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import api from "../api/axios";

export default function SignDocumentPage() {
    const [file, setFile] = useState(null);
    const [status, setStatus] = useState('idle'); // idle | uploading | hashing | ready
    const [fileData, setFileData] = useState({ hash: '', filename: '' });
    const [res, setRes] = useState(null)
    const [allSigners, setAllSigners] = useState([])
    const fileInputRef = useRef(null);
    const navigate = useNavigate();


    const downloadSignatures = () => {
        if (!allSigners || allSigners.length === 0) return;

        const exportDateObject = new Date(Date.now())
        const formattedExportDate = exportDateObject.toLocaleDateString('en-GB', {
            weekday: 'long',
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        })
        const formattedExportTime = exportDateObject.toLocaleTimeString('en-GB', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        })

        // Format the header
        let content = `Document: ${fileData.filename}\n`;
        content += `Fingerprint: ${fileData.hash}\n`;
        content += `Export Date: ${formattedExportDate}, ${formattedExportTime}\n`;
        content += `\n-------------------------------------------------------------------------------------------------------------------------------------------\n`;

        // Map through signers and format each entry
        allSigners.forEach((signer, index) => {
            // Create the specific date format: Day, DD/MM/YYYY
            const dateObj = new Date(signer.timestamp);
            const formattedDate = dateObj.toLocaleDateString('en-GB', {
                weekday: 'long',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            const formattedTime = dateObj.toLocaleTimeString('en-GB', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            content += `Signer #${index + 1}\n`;
            content += `Username:  ${signer.signer_username}\n`;
            content += `Email:     ${signer.signer_email}\n`;
            content += `Date:      ${formattedDate}, ${formattedTime}\n`;
            content += `Signature: ${signer.signature}\n`;
            content += `-------------------------------------------------------------------------------------------------------------------------------------------\n`;


        });

        // Create the file and trigger download
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');

        // Set filename: pdf_name_all_signatures.txt
        const baseName = fileData.filename.replace(/\.[^/.]+$/, ""); // Removes .pdf extension
        link.download = `${baseName}_all_signatures.txt`;

        link.href = url;
        document.body.appendChild(link);
        link.click();

        // Cleanup
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    };

    const handleFileChange = async (e) => {
        const selectedFile = e.target.files[0];
        if (!selectedFile || selectedFile.type !== 'application/pdf') return;

        setFile(selectedFile);
        setStatus('uploading');

        try {
            const formData = new FormData();
            formData.append('file', selectedFile);

            // Step 1: Uploading
            const response = await api.post('/upload', formData, {
                headers: { 'Content-Type': 'multipart/form-data' },
                onUploadProgress: (progressEvent) => {
                    if (progressEvent.progress === 1) setStatus('hashing');
                }
            });

            const { hash, filename } = response.data;

            const result = await Promise.all([
                api.get('/esign/all-signers', { params: { hash } }),
                new Promise(resolve => setTimeout(resolve, 1000))
            ]);

            setFileData({ hash: hash, filename: filename })
            setAllSigners(result[0].data[0].signatures || []);
            setStatus('ready');


        } catch (err) {
            console.error(err);
            setStatus('idle');
            alert("Upload failed. Please try again.");
        }
    };


    return (
        <div className="min-h-screen bg-[#09090b] text-zinc-100 font-sans flex flex-col items-center py-12 px-6">

            {/* Navigation */}
            <div className="max-w-3xl w-full flex justify-start mb-12">
                <button
                    onClick={() => navigate(-1)}
                    className="group flex items-center gap-2 text-zinc-500 hover:text-white transition-colors"
                >
                    <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform" />
                    <span className="text-sm font-bold uppercase tracking-wider">Back to Dashboard</span>
                </button>
            </div>

            <div className="max-w-2xl w-full">
                {/* Step Header */}
                <div className="text-center mb-10">
                    <h1 className="text-3xl font-bold mb-3">See All Signers</h1>
                    <p className="text-zinc-500">Securely upload a pdf and see all the signers.</p>
                </div>

                {/* Main Interaction Card */}
                <div className="bg-[#121214] border border-zinc-800 rounded-3xl p-8 shadow-2xl">

                    {/* STATE: IDLE */}
                    {status === 'idle' && (
                        <div
                            onClick={() => fileInputRef.current.click()}
                            className="group border-2 border-dashed border-zinc-800 hover:border-blue-500 hover:bg-blue-500/5 transition-all rounded-2xl p-16 text-center cursor-pointer"
                        >
                            <Upload size={48} className="mx-auto mb-4 text-zinc-700 group-hover:text-blue-500 transition-colors" />
                            <p className="text-zinc-400 font-medium">Click to upload the PDF</p>
                            <p className="text-zinc-600 text-xs mt-2">Maximum file size: 10MB</p>
                        </div>
                    )}

                    {/* STATE: UPLOADING / HASHING */}
                    {(status === 'uploading' || status === 'hashing') && (
                        <div className="py-12 flex flex-col items-center text-center space-y-6">
                            <div className="relative">
                                <Loader2 size={64} className="text-blue-500 animate-spin" />
                                <div className="absolute inset-0 flex items-center justify-center">
                                    {status === 'uploading' ? <Upload size={20} /> : <Cpu size={20} />}
                                </div>
                            </div>
                            <div>
                                <h3 className="text-xl font-bold capitalize">{status}...</h3>
                                <p className="text-zinc-500 text-sm mt-1">
                                    {status === 'uploading' ? "Sending file to secure server" : "Getting all signers"}
                                </p>
                            </div>
                        </div>
                    )}

                    {/* STATE: READY TO SIGN */}
                    {status === 'ready' && (
                        <div className="space-y-8 animate-in fade-in zoom-in-95 duration-500">
                            {/* Hash Display */}
                            <div className="space-y-3">
                                <div className="flex items-center gap-2 text-zinc-500 text-xs font-bold uppercase">
                                    <Hash size={14} /> Document Fingerprint (Hash)
                                </div>
                                <div className="bg-black/40 border border-zinc-800 p-4 rounded-xl flex items-center justify-between">
                                    <code className="text-blue-400 text-xs font-mono break-all leading-relaxed">
                                        {fileData.hash}
                                    </code>
                                    <CheckCircle2 size={18} className="text-emerald-500 shrink-0 ml-4" />
                                </div>
                            </div>



                            {/* Signer List Section */}
                            {status === 'ready' && (
                                <div className="mt-8 pt-6 border-t border-zinc-800 space-y-4">
                                    <div className="flex items-center justify-between text-zinc-500 text-xs font-bold uppercase tracking-wider">
                                        <div className="flex items-center gap-2">
                                            <User size={14} className="text-blue-500" />
                                            Verified Signers ({allSigners.length})
                                        </div>

                                        {allSigners.length > 0 && (
                                            <button
                                                onClick={downloadSignatures}
                                                className="relative group/btn flex items-center gap-2 px-4 py-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 rounded-xl border border-blue-500/20 hover:border-blue-500/50 transition-all duration-300 active:scale-95 shadow-[0_0_15px_rgba(59,130,246,0.1)] hover:shadow-[0_0_20px_rgba(59,130,246,0.2)]"
                                            >
                                                {/* Subtle inner glow for a "glass" effect */}
                                                <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover/btn:opacity-100 transition-opacity" />

                                                <FileDown size={14} className="relative z-10 group-hover/btn:-translate-y-0.5 transition-transform" />

                                                <span className="relative z-10 text-[11px] font-bold tracking-tight">
                                                    EXPORT LOG
                                                </span>
                                            </button>
                                        )}

                                    </div>

                                    <div className="grid gap-3">
                                        {allSigners.length > 0 ? (
                                            allSigners.map((signerData, index) => (
                                                <div
                                                    key={index}
                                                    className="flex items-center justify-between bg-zinc-900/50 border border-zinc-800/50 p-4 rounded-2xl hover:border-blue-500/30 transition-all group"
                                                >
                                                    {/* Left Side: User Info */}
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center border border-blue-500/20 group-hover:scale-110 transition-transform">
                                                            <User size={18} className="text-blue-400" />
                                                        </div>
                                                        <div className="flex flex-col">
                                                            <p className="text-zinc-200 font-bold group-hover:text-white transition-colors">
                                                                {signerData.signer_username}
                                                            </p>
                                                            <span className="text-[11px] font-medium text-zinc-500">{signerData.signer_email}</span>
                                                        </div>
                                                    </div>

                                                    {/* Right Side: Signature & Timestamp */}
                                                    <div className="flex flex-col items-end gap-2 max-w-[50%]">
                                                        {/* Signature Badge */}
                                                        <div className="flex items-center gap-2 bg-black/40 px-3 py-1.5 rounded-lg border border-zinc-800 group-hover:border-blue-500/20 transition-all">
                                                            <Key size={10} className="text-blue-500/70" />
                                                            <code className="text-[10px] text-blue-400/90 font-mono truncate max-w-[150px]">
                                                                {signerData.signature}
                                                            </code>
                                                        </div>

                                                        {/* Timestamp Badge */}
                                                        <div className="flex items-center gap-1.5 text-zinc-500">
                                                            <ShieldCheck size={11} className="text-emerald-500/60" />
                                                            <span className="text-[10px] font-medium uppercase tracking-tight">
                                                                {new Date(signerData.timestamp).toLocaleDateString(undefined, {
                                                                    month: 'short',
                                                                    day: 'numeric',
                                                                    hour: '2-digit',
                                                                    minute: '2-digit'
                                                                })}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        ) : (
                                            <div className="text-center py-10 bg-zinc-900/30 rounded-2xl border border-dashed border-zinc-800">
                                                <p className="text-zinc-500 text-sm italic">No signatures found for this document.</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                        </div>
                    )}




                </div>
            </div>

            <input
                type="file"
                ref={fileInputRef}
                className="hidden"
                accept=".pdf"
                onChange={handleFileChange}
            />
        </div>
    );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Changefont.jsx] 
// placeholder page for Changefont feature.
export default function Changefont() {
  return (
    <div className="min-h-screen bg-zinc-900 text-zinc-100 flex items-center justify-center px-4">
      
      <div
        className="
          w-full max-w-md
          bg-zinc-800 border border-zinc-700
          rounded-xl p-6 sm:p-8
          shadow-lg text-center
        "
      >
        {/* ICON */}
        <div className="text-4xl mb-3">ðŸ”¤</div>

        {/* TITLE */}
        <h1 className="text-2xl sm:text-3xl font-semibold mb-2">
          Change PDF Font
        </h1>

        {/* DESCRIPTION */}
        <p className="text-zinc-400 text-sm sm:text-base mb-6">
          Replace the font of your entire PDF with a clean, professional style.
        </p>

        {/* BADGE */}
        <div className="inline-block px-4 py-1.5 rounded-full text-xs sm:text-sm font-medium bg-zinc-700 text-zinc-300">
          Coming soon
        </div>
      </div>
    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Dashboard.jsx] 
import { useNavigate } from "react-router-dom";
import FeatureCard from "../components/FeatureCard";
import { useEffect, useState } from "react";
import api from "../api/axios";

export default function Dashboard() {
  const navigate = useNavigate();
  const [user,setUser] = useState('Guest')

  useEffect(()=>{

    const getUser = async()=>{
      console.log("")
      const response = await api.get('/get-user')  ;
      setUser(response.data)
      console.log("exe",response.data)
      console.log(user)
    }
    
    getUser()
  },[])
  const logout = () => {
    localStorage.removeItem("token");
    navigate("/login");
  };

  return (
    <div className="min-h-screen bg-zinc-900 text-zinc-100 px-4 py-10">

      {/* HEADER */}
      <div className="max-w-6xl mx-auto mb-10">
        <h1 className="text-3xl sm:text-4xl font-bold">
          ðŸ“„ PDF Editor
        </h1>
        <p className="text-zinc-400 mt-1">
          Powerful tools to work with PDFs
        </p> 
      </div>

      {/* USER WELCOME SECTION */}
<div className="max-w-6xl mx-auto mb-8 px-4 py-6 bg-zinc-900/50 border border-zinc-800 rounded-2xl flex items-center justify-between">
  <div>
    {user && user.username ? (
      <>
        <h2 className="text-xl font-semibold text-white tracking-tight">
          Hey! <span className="text-indigo-400">@{user.username}</span> 
        </h2>
        <p className="text-sm text-zinc-500">Ready to manage your documents?</p>
      </>
    ) : (
      /* SKELETON LOADER (Shows while 'user' is null or 'Guest') */
      <div className="animate-pulse space-y-2">
        <div className="h-6 w-48 bg-zinc-800 rounded-md"></div>
        <div className="h-4 w-32 bg-zinc-800 rounded-md"></div>
      </div>
    )}
  </div>

  {/* Optional: User Initial Avatar */}
  <div className="h-12 w-12 rounded-full bg-gradient-to-tr from-indigo-600 to-purple-600 flex items-center justify-center text-lg font-bold shadow-lg shadow-indigo-500/20">
    {user?.username?.charAt(0).toUpperCase() || "?"}
  </div>
</div>

      {/* FEATURES GRID */}
      <div className="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">

        <FeatureCard
          title="Add Watermark"
          icon="ðŸ’§"
          description="Add text watermark to all pages of a PDF"
          onClick={() => navigate("/watermark")}
        />

        <FeatureCard
          title="E-Sign PDF"
          icon="âœï¸"
          description="Digitally sign your PDF documents"
          onClick={() => navigate("/esign")}
        />

        <FeatureCard
          title="Translate PDF"
          icon="ðŸŒ"
          description="Translate PDFs into another language"
          onClick={() => navigate("/translate")}
        />

        <FeatureCard
          title="Summarize PDF"
          icon="ðŸ“"
          description="Get a short summary of a PDF"
          onClick={() => navigate("/summarize")}
        />

        <FeatureCard
          title="Change Font"
          icon="ðŸ”¤"
          description="Replace PDF fonts with a professional style"
          onClick={() => navigate("/change-font")}
        />

        <FeatureCard
          title="Scanned to Standard"
          icon="ðŸ“„"
          description="Convert scanned PDFs into selectable and editable text"
          onClick={() => navigate("/scanned-to-standard")}
        />
        <FeatureCard
          title="Receipt Generator"
          icon="ðŸ“„"
          description="Generate receipts for your documents"
          onClick={() => navigate("/receipt-generator")}
        />
      </div>

      <div className="max-w-6xl mx-auto mt-10 flex justify-end">
        <button onClick={logout} className="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-red-400 border border-red-500/30 rounded-md hover:bg-red-500/10 hover:text-red-300  transition">
          Logout
        </button>
      </div>

    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Esign.jsx] 
import React, { useState, useMemo, useRef, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Trash2, GripVertical, ChevronDown, UploadCloud, FileText, Command, ArrowRight } from 'lucide-react';
import { DndContext, closestCenter, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { arrayMove, SortableContext, verticalListSortingStrategy, useSortable } from '@dnd-kit/sortable';
import PlacementArena from '../components/PlacementArena.jsx';
import { CSS } from '@dnd-kit/utilities';
import { pdfjs } from 'react-pdf';
import axios from "axios";

// Styles for PDF rendering
import 'react-pdf/dist/Page/AnnotationLayer.css';
import 'react-pdf/dist/Page/TextLayer.css';

pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;

// sortable card (White Card on Grey Background) ---

const SortableSignerCard = ({ s, hoveredId, setHoveredId, updateSigner, removeSigner, indexRef, isNew }) => {
  const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({ id: s.id });
  const nameInputRef = useRef(null);

  useEffect(() => {
    if (isNew && nameInputRef.current) {
      nameInputRef.current.focus();
    }
  }, [isNew]);

  const style = {
    transform: CSS.Translate.toString(transform),
    transition: transition || 'transform 200ms ease',
    zIndex: isDragging ? 50 : 'auto',
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      onMouseEnter={() => setHoveredId(s.id)}
      onMouseLeave={() => setHoveredId(null)}
      className={`group relative flex items-start gap-3 p-4 rounded-xl border transition-all duration-200 
        ${isDragging ? 'bg-white shadow-2xl border-slate-800 scale-[1.02] cursor-grabbing z-50' : 'bg-white border-slate-200 hover:border-slate-300'}
        ${hoveredId === s.id && !isDragging ? 'shadow-md border-slate-300' : 'shadow-sm'}`}
    >
      {/* Drag Handle */}
      <div
        {...attributes}
        {...listeners}
        tabIndex={-1}
        className="mt-2 cursor-grab active:cursor-grabbing p-1.5 rounded-md hover:bg-slate-100 text-slate-300 hover:text-slate-600 transition-colors touch-none outline-none"
      >
        <GripVertical size={16} />
      </div>

      {/* Step Number */}
      <div className="flex flex-col items-center">
        <span className="text-[9px] font-bold text-slate-400 uppercase tracking-wider mb-1">Step</span>
        <div className="flex items-center justify-center w-10 h-10 bg-slate-50 border border-slate-200 rounded-lg focus-within:border-slate-800 focus-within:bg-white transition-all">
          <input
            ref={indexRef}
            type="number"
            value={s.seq === 0 ? '' : s.seq}
            onChange={(e) => updateSigner(s.id, 'seq', e.target.value === '' ? 0 : parseInt(e.target.value))}
            className="w-full text-center bg-transparent font-bold text-slate-700 outline-none no-spinner text-sm"
          />
        </div>
      </div>

      {/* Data Inputs */}
      <div className="flex-1 grid grid-cols-1 gap-3">
        <div>
          <input
            ref={nameInputRef}
            className="w-full px-0 py-1 bg-transparent border-b border-slate-100 text-sm font-bold text-slate-800 placeholder-slate-300 outline-none focus:border-slate-800 transition-colors"
            placeholder="Recipient Name"
            value={s.name}
            onChange={(e) => updateSigner(s.id, 'name', e.target.value)}
          />
        </div>
        <div>
          <input
            className="w-full px-0 py-0.5 bg-transparent text-xs font-medium text-slate-500 placeholder-slate-300 outline-none focus:text-slate-800 transition-colors"
            placeholder="recipient@email.com"
            value={s.email}
            onChange={(e) => updateSigner(s.id, 'email', e.target.value)}
          />
        </div>
      </div>

      {/* Delete Action */}
      <button
        onClick={() => removeSigner(s.id)}
        tabIndex={-1}
        className="mt-1 opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all focus:opacity-100"
      >
        <Trash2 size={16} />
      </button>
    </div>
  );
};

// MAIN WORKFLOW PAGE
const Esign = () => {
  const navigate = useNavigate();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [view, setView] = useState('config');
  const [newestSignerId, setNewestSignerId] = useState(null);
  const [signers, setSigners] = useState([{ id: '1', name: '', email: '', seq: 1 }]);
  const [selectedFile, setSelectedFile] = useState(null);
  const [activeSignerIndex, setActiveSignerIndex] = useState(0);
  const [hoveredId, setHoveredId] = useState(null);
  const indexRefs = useRef({});

  const sensors = useSensors(useSensor(PointerSensor, { activationConstraint: { distance: 3 } }));

  const getInitials = (name) => name ? name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : '.';

  const groupedSteps = useMemo(() => {
    return Object.entries(
      signers.reduce((acc, s) => {
        if (!acc[s.seq]) acc[s.seq] = [];
        acc[s.seq].push(s);
        return acc;
      }, {})
    ).sort(([a], [b]) => Number(a) - Number(b));
  }, [signers]);

  const handleNodeClick = (id) => {
    const targetInput = indexRefs.current[id];
    if (targetInput) {
      targetInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
      targetInput.focus();
      targetInput.select();
      setHoveredId(id);
    }
  };

  const updateSigner = (id, field, value) => {
    setSigners(prev => {
      let updated = prev.map(s => s.id === id ? { ...s, [field]: value } : s);
      if (field === 'seq') {
        updated = updated.sort((a, b) => a.seq - b.seq);
      }
      return updated;
    });
  };

  const addSigner = () => {
    const newId = Date.now().toString();
    const newSeq = signers.length > 0 ? signers[signers.length - 1].seq + 1 : 1;
    setNewestSignerId(newId);
    setSigners([...signers, { id: newId, name: '', email: '', seq: newSeq }]);
  };

  const handleDragEnd = (event) => {
    const { active, over } = event;
    if (active && over && active.id !== over.id) {
      setSigners((prev) => {
        const oldIndex = prev.findIndex((i) => i.id === active.id);
        const newIndex = prev.findIndex((i) => i.id === over.id);
        const reordered = arrayMove(prev, oldIndex, newIndex);

        const prevNeighbor = reordered[newIndex - 1];
        const nextNeighbor = reordered[newIndex + 1];

        if (prevNeighbor && nextNeighbor && prevNeighbor.seq === nextNeighbor.seq) {
          return reordered.map(item => item.id === active.id ? { ...item, seq: prevNeighbor.seq } : item);
        }

        let currentSeq = 1;
        const result = [];
        for (let i = 0; i < reordered.length; i++) {
          if (i > 0) {
            const prevItem = reordered[i - 1];
            const isDraggedItem = reordered[i].id === active.id;
            if (isDraggedItem || reordered[i].seq !== prevItem.seq) {
              currentSeq++;
            }
          }
          result.push({ ...reordered[i], seq: currentSeq });
        }
        return result;
      });
    }
  };

  const handleSave = async () => {
    if (!selectedFile) return alert("Please upload a PDF document first.");
    if (signers.length === 0) return alert("Please add at least one recipient.");

    const formData = new FormData();
    formData.append('file', selectedFile);
    formData.append('title', 'Signature Request');
    formData.append('signers', JSON.stringify(signers));

    setIsSubmitting(true);

    try {
      const response = await axios.post('http://localhost:5000/api/esign/save-flow', formData, {
        headers: { 'Content-Type': 'multipart/form-data' },
      });
      navigate(`/track/${response.data.id}`);
    } catch (error) {
      console.error("Error saving workflow:", error);
      alert(error.response?.data?.message || "Failed to save workflow.");
      setIsSubmitting(false);
    }
  };

  const proceedToPlacement = () => {
    if (!selectedFile || signers.length === 0) {
      alert("Upload a PDF and add at least one signer.");
      return;
    }
    setSigners(prev => prev.map(s => ({ ...s, fields: s.fields || [] })));
    setView('placement');
  };

  if (view === 'placement') {
    return (
      <PlacementArena
        signers={signers}
        setSigners={setSigners}
        activeSignerIndex={activeSignerIndex}
        setActiveSignerIndex={setActiveSignerIndex}
        pdfFile={selectedFile}
        onBack={() => setView('config')}
        onSave={handleSave}
        isSubmitting={isSubmitting}
      />
    );
  }

  return (
    <div className="flex h-screen w-screen bg-slate-100 text-slate-800 font-sans overflow-hidden">
      <style>{`.no-scrollbar::-webkit-scrollbar { display: none; } .no-spinner::-webkit-inner-spin-button, .no-spinner::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }`}</style>

      {/* LEFT PANEL: CONFIGURATION */}
      {/* Background set to slate-50 (light grey) instead of white */}
      <div className="w-[500px] h-full border-r border-slate-200 flex flex-col bg-slate-50 shadow-xl z-20">

        {/* 1. BRAND HEADER */}
        <header className="px-8 py-6 border-b border-slate-200/60 flex items-center gap-3 bg-slate-50">
          <div className="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white shadow-lg shadow-slate-300">
            <Command size={20} />
          </div>
          <div>
            <h1 className="font-bold text-slate-900 text-lg tracking-tight leading-none">e-Sign</h1>
            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Enterprise Edition</p>
          </div>
        </header>

        <div className="flex-1 overflow-y-auto space-y-8 p-8 no-scrollbar scroll-smooth">

          {/* 2. MODERN UPLOAD ZONE (White card on grey bg) */}
          <div className="space-y-3">
            <label className="text-[11px] font-black text-slate-400 tracking-wide">Upload PDF to request signatures</label>
            <div className="relative group">
              <input
                type="file"
                accept="application/pdf"
                onChange={(e) => setSelectedFile(e.target.files[0])}
                className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
              />
              <div className={`border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center transition-all duration-300 shadow-sm
                        ${selectedFile ? 'border-indigo-500 bg-white' : 'border-slate-300 bg-white group-hover:border-slate-400 group-hover:bg-slate-50'}`}>
                {selectedFile ? (
                  <>
                    <div className="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-full flex items-center justify-center mb-3"><FileText size={24} /></div>
                    <p className="text-sm font-bold text-indigo-900 truncate max-w-[250px]">{selectedFile.name}</p>
                    <p className="text-[10px] text-indigo-500 mt-1 font-medium">Ready to process</p>
                  </>
                ) : (
                  <>
                    <div className="w-12 h-12 bg-slate-50 border border-slate-200 text-slate-400 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform"><UploadCloud size={24} /></div>
                    <p className="text-sm font-bold text-slate-600">Click to upload PDF</p>
                    <p className="text-[10px] text-slate-400 mt-1">Or drag and drop file here</p>
                  </>
                )}
              </div>
            </div>
          </div>

          {/* 3. SIGNER LIST */}
          <div className="space-y-4">
            <div className="flex justify-between items-end border-b border-slate-200 pb-2">
              <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest">Recipients & Order</label>
              <span className="text-[10px] font-bold text-slate-500 bg-slate-200/50 px-2 py-1 rounded-md">{signers.length} Recipients</span>
            </div>

            <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
              <SortableContext items={signers} strategy={verticalListSortingStrategy}>
                <div className="space-y-3">
                  {signers.map((s) => (
                    <SortableSignerCard
                      key={s.id}
                      s={s}
                      isNew={s.id === newestSignerId}
                      hoveredId={hoveredId}
                      setHoveredId={setHoveredId}
                      updateSigner={updateSigner}
                      removeSigner={(id) => setSigners(signers.filter(sig => sig.id !== id))}
                      indexRef={(el) => (indexRefs.current[s.id] = el)}
                    />
                  ))}
                </div>
              </SortableContext>
            </DndContext>

            <button
              onClick={addSigner}
              className="w-full py-3 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 hover:text-slate-800 hover:border-slate-800 hover:bg-white transition-all flex items-center justify-center gap-2 font-bold text-xs uppercase tracking-wider bg-slate-50"
            >
              <Plus size={14} strokeWidth={3} /> Add Next Recipient
            </button>
          </div>
        </div>

        {/* 4. FOOTER ACTION */}
        <div className="p-6 border-t border-slate-200 bg-slate-50">
          <button
            onClick={proceedToPlacement}
            disabled={!selectedFile || signers.length === 0}
            className="w-full bg-slate-900 hover:bg-black text-white py-4 rounded-xl font-bold text-sm flex items-center justify-center gap-3 transition-all active:scale-[0.98] shadow-lg shadow-slate-300 disabled:opacity-50 disabled:shadow-none"
          >
            Configure Fields <ArrowRight size={16} />
          </button>
        </div>
      </div>

      {/* RIGHT PANEL: VISUALIZATION */}
      {/* Darker background: slate-100, Clean (No Dots) */}
      <div className="flex-1 h-full flex flex-col bg-slate-100 relative overflow-hidden">

        {/* Soft Gradient Overlay for depth */}
        <div className="absolute inset-0 bg-gradient-to-tr from-slate-200/40 via-transparent to-transparent pointer-events-none"></div>

        <div className="flex-1 overflow-y-auto no-scrollbar relative flex flex-col items-center pt-24 px-10 z-10">
          <div className="absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-[2px] bg-slate-300 z-0"></div>
          <div className="w-full z-10 max-w-md">
            {groupedSteps.map(([seq, group], idx) => (
              <React.Fragment key={seq}>
                <div className="w-full relative py-4 flex flex-col items-center">
                  <div className="flex justify-center items-center gap-6">
                    {group.map((signer) => (
                      <div key={signer.id}
                        onMouseEnter={() => setHoveredId(signer.id)}
                        onMouseLeave={() => setHoveredId(null)}
                        onClick={() => handleNodeClick(signer.id)}
                        className="relative group cursor-pointer"
                      >
                        {/* Tooltip */}
                        <div className={`absolute -top-14 left-1/2 -translate-x-1/2 px-4 py-2 bg-slate-800 text-white rounded-lg transition-all duration-200 pointer-events-none z-50 flex flex-col items-center shadow-xl w-max ${hoveredId === signer.id ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-2'}`}>
                          <span className="text-[11px] font-bold whitespace-nowrap">{signer.name || 'Recipient'}</span>
                          <span className="text-[9px] text-slate-300 whitespace-nowrap">{signer.email || 'No email'}</span>
                          <div className="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-slate-800 rotate-45"></div>
                        </div>

                        {/* Node */}
                        <div className={`w-14 h-14 rounded-full flex items-center justify-center text-xs font-bold border-[3px] transition-all duration-300 shadow-md bg-white
                            ${hoveredId === signer.id ? 'border-slate-800 text-slate-800 scale-110 ring-4 ring-slate-800/10' : 'border-slate-300 text-slate-400 group-hover:border-slate-400'}`}>
                          {getInitials(signer.name)}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                {idx !== groupedSteps.length - 1 && (
                  <div className="w-full flex justify-center py-2 relative z-20">
                    <div className="bg-slate-100 p-1.5 rounded-full border-2 border-slate-300 text-slate-400 shadow-sm">
                      <ChevronDown size={14} strokeWidth={3} />
                    </div>
                  </div>
                )}
              </React.Fragment>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Esign;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Login.jsx] 
import { useState } from "react";
import api from "../api/axios";
import { useNavigate } from "react-router-dom";
import { Eye, EyeOff } from "lucide-react";

export default function Login() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const submit = async () => {
    if (!email || !password) return;

    try {
      setLoading(true);
      const res = await api.post("/auth/login", { email, password });
      console.log('sir, did we get here,', res.data.token)
      localStorage.setItem("token", res.data.token);
      navigate("/dashboard");
    } catch {
      alert("Invalid credentials");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-zinc-900 text-zinc-100 px-4">

      {/* APP TITLE */}
      <div className="mb-6 sm:mb-8 text-center">
        <h1 className="text-3xl sm:text-4xl font-bold tracking-tight">
          ðŸ“„ PDF Editor
        </h1>
        <p className="text-zinc-400 mt-1 text-sm sm:text-base">
          Edit â€¢ Sign â€¢ Translate PDFs
        </p>
      </div>

      {/* LOGIN CARD */}
      <div
        className="
          w-full
          max-w-sm sm:max-w-md
          bg-zinc-800 border border-zinc-700
          rounded-xl p-5 sm:p-6
          shadow-lg
        "
      >
        <h2 className="text-xl sm:text-2xl font-semibold text-center mb-5 sm:mb-6">
          Welcome back
        </h2>

        <form
          onSubmit={(e) => {
            e.preventDefault();
            submit();
          }}
          className="space-y-3 sm:space-y-4"
        >
          {/* EMAIL */}
          <input
            type="email"
            placeholder="Email"
            className="
              w-full px-3 py-2 sm:py-2.5
              rounded-md
              bg-zinc-900 border border-zinc-700
              text-zinc-100 placeholder-zinc-400
              focus:outline-none focus:ring-2 focus:ring-indigo-500
              text-sm sm:text-base
            "
            value={email}
            onChange={(e) => setEmail(e.target.value)}
          />

          {/* PASSWORD WITH TOGGLE */}
          <div className="relative">
            <input
              type={showPassword ? "text" : "password"}
              placeholder="Password"
              className="
                w-full px-3 py-2 sm:py-2.5 pr-10
                rounded-md
                bg-zinc-900 border border-zinc-700
                text-zinc-100 placeholder-zinc-400
                focus:outline-none focus:ring-2 focus:ring-indigo-500
                text-sm sm:text-base
              "
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />

            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="
                absolute inset-y-0 right-2
                flex items-center
                text-zinc-400 hover:text-zinc-200
                focus:outline-none
              "
              aria-label={showPassword ? "Hide password" : "Show password"}
            >
              {showPassword ? (
                <EyeOff className="w-4 h-4 sm:w-5 sm:h-5" />
              ) : (
                <Eye className="w-4 h-4 sm:w-5 sm:h-5" />
              )}
            </button>
          </div>

          <button
            type="submit"
            disabled={loading}
            className="
              w-full py-2.5 rounded-md font-medium
              bg-indigo-600 hover:bg-indigo-500
              transition disabled:opacity-50
              text-sm sm:text-base
            "
          >
            {loading ? "Logging in..." : "Login"}
          </button>
        </form>

        <p className="text-xs sm:text-sm text-zinc-400 text-center mt-4">
          Donâ€™t have an account?{" "}
          <span
            onClick={() => navigate("/signup")}
            className="text-indigo-400 cursor-pointer hover:underline"
          >
            Sign up
          </span>
        </p>
      </div>
    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\RecieptGenerator.jsx] 
export default function ReceiptGenerator() {
  return (
    <div className="min-h-screen bg-zinc-900 text-zinc-100 flex items-center justify-center px-4">
      <div
        className="
          w-full max-w-md
          bg-zinc-800 border border-zinc-700
          rounded-xl p-6 sm:p-8
          shadow-lg text-center
        "
      >
        <div className="text-4xl mb-3">ðŸŒ</div>

        <h1 className="text-2xl sm:text-3xl font-semibold mb-2">
            Receipt Generator
          </h1>

        <p className="text-zinc-400 text-sm sm:text-base mb-6">
          Generate receipts for your documents with ease.
        </p>

        <div className="inline-block px-4 py-1.5 rounded-full text-xs sm:text-sm font-medium bg-zinc-700 text-zinc-300">
          Coming soon 
        </div>
      </div>
    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\RegistryPage.jsx] 
import React, { useState, useEffect } from 'react';
import { ArrowLeft, User, Mail, Key, Copy, Check, Search, Users } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import api from "../api/axios";

export default function RegisteredUsersPage() {
    const [users, setUsers] = useState([]);
    const [searchTerm, setSearchTerm] = useState("");
    const [copiedKey, setCopiedKey] = useState(null);
    const navigate = useNavigate();

    useEffect(() => {
        const fetchUsers = async () => {
            try {
                const response = await api.get('/esign/all-users');
                setUsers(response.data);
            } catch (err) {
                console.error("Failed to fetch users", err);
            }
        };
        fetchUsers();
    }, []);

    const handleCopy = (publicKey) => {
        navigator.clipboard.writeText(publicKey);
        setCopiedKey(publicKey);
        setTimeout(() => setCopiedKey(null), 2000);
    };

    const filteredUsers = users.filter(user =>
        user.username.toLowerCase().includes(searchTerm.toLowerCase()) ||
        user.email.toLowerCase().includes(searchTerm.toLowerCase())
    );

    // Inside RegisteredUsersPage.jsx
    useEffect(() => {
        const fetchUsers = async () => {
            try {
                // Ensure this URL matches your backend port and route prefix
                const response = await api.get('esign/all-users');

                // response.data will now be the array from your PostgreSQL 'users' table
                setUsers(response.data);
            } catch (err) {
                console.error("Failed to fetch users:", err);
                // Optional: set an error state to show a message to the user
            }
        };
        fetchUsers();
    }, []);

    return (
        <div className="min-h-screen bg-[#09090b] text-zinc-100 font-sans py-12 px-6 flex flex-col items-center">

            {/* Header & Search */}
            <div className="max-w-4xl w-full space-y-8">
                <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
                    <div>
                        <button
                            onClick={() => navigate(-1)}
                            className="group flex items-center gap-2 text-zinc-500 hover:text-white transition-colors mb-4"
                        >
                            <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform" />
                            <span className="text-xs font-bold uppercase tracking-widest">Back</span>
                        </button>
                        <h1 className="text-3xl font-bold flex items-center gap-3">
                            <Users className="text-blue-500" size={32} />
                            Directory
                        </h1>
                        <p className="text-zinc-500 mt-1">View and manage all registered system users.</p>
                    </div>

                    <div className="relative group max-w-sm w-full">
                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-zinc-600 group-focus-within:text-blue-500 transition-colors" size={18} />
                        <input
                            type="text"
                            placeholder="Search by name or email..."
                            className="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-3 pl-12 pr-4 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all"
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>
                </div>

                {/* Users Grid */}
                <div className="grid gap-4">
                    {filteredUsers.length > 0 ? (
                        filteredUsers.map((user) => (
                            <div
                                key={user.id}
                                className="bg-[#121214] border border-zinc-800 p-5 rounded-3xl flex flex-col md:flex-row md:items-center justify-between gap-6 hover:border-zinc-700 transition-all group"
                            >
                                {/* User Identity */}
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/20 flex items-center justify-center text-blue-400 group-hover:scale-105 transition-transform">
                                        <User size={24} />
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-zinc-100 tracking-tight text-lg">@{user.username}</h3>
                                        <div className="flex items-center gap-2 text-zinc-500 text-sm">
                                            <Mail size={14} />
                                            <span>{user.email}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Public Key Section */}
                                <div className="flex flex-col md:items-end gap-2 flex-1 max-w-md">
                                    <div className="flex items-center gap-2 text-[10px] font-bold text-zinc-600 uppercase tracking-widest">
                                        <Key size={12} /> Public Key
                                    </div>
                                    <div className="w-full bg-black/40 border border-zinc-800 rounded-xl p-2 pl-4 flex items-center justify-between gap-3 group/key hover:border-zinc-600 transition-colors">
                                        <code className="text-[11px] font-mono text-blue-400/80 truncate">
                                            {user.public_key}
                                        </code>
                                        <button
                                            onClick={() => handleCopy(user.public_key)}
                                            className="p-2 bg-zinc-800 hover:bg-blue-600 rounded-lg text-zinc-400 hover:text-white transition-all shrink-0"
                                            title="Copy Key"
                                        >
                                            {copiedKey === user.public_key ? <Check size={16} /> : <Copy size={16} />}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))
                    ) : (
                        <div className="text-center py-20 bg-[#121214] rounded-3xl border border-dashed border-zinc-800">
                            <p className="text-zinc-500 font-medium">No users found matching your search.</p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\ScannedToStandard.jsx] 
// placeholder page for Scanned to Standard feature.
export default function ScannedToStandard() {
  return (
    <div className="min-h-screen bg-zinc-900 text-zinc-100 flex items-center justify-center px-4">
      <div
        className="
          w-full max-w-md
          bg-zinc-800 border border-zinc-700
          rounded-xl p-6 sm:p-8
          shadow-lg text-center
        "
      >
        <div className="text-4xl mb-3">ðŸ“„</div>

        <h1 className="text-2xl sm:text-3xl font-semibold mb-2">
          Scanned to Standard
        </h1>

        <p className="text-zinc-400 text-sm sm:text-base mb-6">
          Convert scanned PDF documents into selectable and editable text.
        </p>

        <div className="inline-block px-4 py-1.5 rounded-full text-xs sm:text-sm font-medium bg-zinc-700 text-zinc-300">
          Coming soon ðŸš§
        </div>
      </div>
    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\SignatureHistoryPage.jsx] 
import React, { useState, useEffect } from 'react';
import { 
    FileText, 
    Clock, 
    ExternalLink, 
    ShieldCheck, 
    ArrowLeft, 
    Search,
    Fingerprint
} from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import api from "../api/axios";

const SignatureHistoryPage = () => {
    const [history, setHistory] = useState([]);
    const [loading, setLoading] = useState(true);
    const [searchTerm, setSearchTerm] = useState("");
    const navigate = useNavigate();

    // 1. Fetch the joined data (Signature + Filename)
    useEffect(() => {
        const fetchHistory = async () => {
            try {
                // This calls the route we built with the INNER JOIN
                const response = await api.get('/esign/history');
                setHistory(response.data);
            } catch (err) {
                console.error("Failed to fetch signature history:", err);
            } finally {
                setLoading(false);
            }
        };
        fetchHistory();
    }, []);

    // 2. Filter logic for the search bar
    const filteredHistory = history.filter(item => 
        item.filename.toLowerCase().includes(searchTerm.toLowerCase()) ||
        item.file_hash.toLowerCase().includes(searchTerm.toLowerCase())
    );

    if (loading) {
        return (
            <div className="min-h-screen bg-[#09090b] flex items-center justify-center">
                <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-blue-500"></div>
            </div>
        );
    }

    return (
        <div className="min-h-screen bg-[#09090b] text-zinc-100 py-12 px-6">
            <div className="max-w-4xl mx-auto space-y-8">
                
                {/* Header Section */}
                <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
                    <div>
                        <button
                            onClick={() => navigate(-1)}
                            className="group flex items-center gap-2 text-zinc-500 hover:text-white transition-colors mb-4"
                        >
                            <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform" />
                            <span className="text-xs font-bold uppercase tracking-widest">Dashboard</span>
                        </button>
                        <h1 className="text-3xl font-bold flex items-center gap-3">
                            <Fingerprint className="text-blue-500" size={32} />
                            Your Signature History
                        </h1>
                        <p className="text-zinc-500 mt-1">
                            Verify and access every document you've digitally signed.
                        </p>
                    </div>

                    {/* Search Bar */}
                    <div className="relative group max-w-sm w-full">
                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-zinc-600 group-focus-within:text-blue-500 transition-colors" size={18} />
                        <input 
                            type="text"
                            placeholder="Search by filename or hash..."
                            className="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-3 pl-12 pr-4 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all"
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>
                </div>

                {/* Main List */}
                <div className="grid gap-4">
                    {filteredHistory.length > 0 ? (
                        filteredHistory.map((item, index) => (
                            <div 
                                key={index} 
                                className="bg-[#121214] border border-zinc-800 p-6 rounded-3xl flex flex-col md:flex-row md:items-center justify-between gap-6 hover:border-zinc-700 transition-all group"
                            >
                                <div className="flex items-start gap-4 flex-1">
                                    <div className="w-12 h-12 rounded-2xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center text-blue-400 shrink-0">
                                        <FileText size={24} />
                                    </div>
                                    <div className="space-y-2 overflow-hidden">
                                        <h3 className="font-bold text-zinc-100 text-lg truncate pr-4">
                                            {item.filename}
                                        </h3>
                                        <div className="flex flex-wrap items-center gap-4 text-[11px] font-bold text-zinc-500 uppercase tracking-tighter">
                                            <div className="flex items-center gap-1.5 bg-zinc-800/50 px-2 py-1 rounded-md">
                                                <Clock size={12} />
                                                {new Date(item.timestamp).toLocaleString()}
                                            </div>
                                            <div className="flex items-center gap-1.5 text-emerald-500">
                                                <ShieldCheck size={12} />
                                                Signature Verified
                                            </div>
                                        </div>
                                        {/* Signature Fragment */}
                                        <div className="mt-2 text-[10px] font-mono text-zinc-600 bg-black/30 p-2 rounded-lg border border-zinc-800/50 truncate">
                                            SIGNATURE: {item.signature}
                                        </div>
                                    </div>
                                </div>

                                {/* Clickable View PDF Link */}
                                <div className="flex items-center gap-3 shrink-0">
                                    <a 
                                        href={`http://localhost:5000/uploads/${item.filename}`} 
                                        target="_blank" 
                                        rel="noreferrer"
                                        className="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold px-6 py-3 rounded-2xl transition-all shadow-lg shadow-blue-500/10 hover:shadow-blue-500/20"
                                    >
                                        View Document
                                        <ExternalLink size={14} />
                                    </a>
                                </div>
                            </div>
                        ))
                    ) : (
                        <div className="text-center py-20 bg-[#121214] rounded-3xl border border-dashed border-zinc-800">
                            <p className="text-zinc-500 font-medium">No signature records found.</p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};

export default SignatureHistoryPage;
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\SignDocument.jsx] 
import React, { useState, useRef } from 'react';
import { Upload, ArrowLeft, ShieldCheck, Cpu, Hash, Key, CheckCircle2, Loader2 } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import api from "../api/axios";
// import saveSign from '../../../backend/src/utils/saveSign';

export default function SignDocumentPage() {
  const [file, setFile] = useState(null);
  const [status, setStatus] = useState('idle'); // idle | uploading | hashing | ready
  const [fileData, setFileData] = useState({ hash: '', filename: '' });
  const [privateKey, setPrivateKey] = useState('');
  const [res, setRes] = useState(null)
  const [duplicate, setDuplicate] = useState(false)
  const fileInputRef = useRef(null);
  const navigate = useNavigate();

  const handleFileChange = async (e) => {
    const selectedFile = e.target.files[0];
    if (!selectedFile || selectedFile.type !== 'application/pdf') return;

    setFile(selectedFile);
    setStatus('uploading');

    const formData = new FormData();
    formData.append('file', selectedFile);

    try {
      // Step 1: Uploading
      const response = await api.post('/upload', formData, {
        headers: { 'Content-Type': 'multipart/form-data' },
        onUploadProgress: (progressEvent) => {
          if (progressEvent.progress === 1) setStatus('hashing');
        }
      });

      // Simulated delay for "Hashing" feedback so user sees the process
      setTimeout(() => {
        setFileData({
          hash: response.data.hash,
          filename: response.data.filename
        });
        setStatus('ready');
      }, 1500);

    } catch (err) {
      console.error(err);
      setStatus('idle');
      alert("Upload failed. Please try again.");
    }
  };


  const handleSign = async () => {

    try {

      console.log('hurray');
      console.log("Privatekey:", privateKey)
      console.log("hashKey:", fileData.hash)
      const resp = await api.post('/esign/sign', { privateKey, pdfHash: fileData.hash })
      console.log(resp.data);
      const signatureData = resp.data;
      const token = localStorage.getItem('token');
      setRes(signatureData)
      let saveSign;
      if (signatureData && signatureData.signature) {
        saveSign = await api.post('/esign/save-sign', { pdfHash: fileData.hash, sign: signatureData.signature }, {
          headers: {
            Authorization: `Bearer ${token}` // This defines req.user on the server
          }
        })


        console.log("one steell\n\n\n\n\n\n\n\n\n")
        console.log('Success! Document recorded:', saveSign.data.message);
      }
      else {
        console.error("No signature returned from the first step.");
      }
      console.log('helopp')
      // console.log(saveSign);
      console.log(res)
    }
    catch (err) {

      if (err.response && err.response.status === 409) {
        console.log("Duplicate detected");
        setDuplicate(true);
        // Optional: alert(err.response.data.message);
      } else {
        console.error("A different error occurred:", err.message);
      }
    }
  }


  return (
    <div className="min-h-screen bg-[#09090b] text-zinc-100 font-sans flex flex-col items-center py-12 px-6">

      {/* Navigation */}
      <div className="max-w-3xl w-full flex justify-start mb-12">
        <button
          onClick={() => navigate(-1)}
          className="group flex items-center gap-2 text-zinc-500 hover:text-white transition-colors"
        >
          <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform" />
          <span className="text-sm font-bold uppercase tracking-wider">Back to Dashboard</span>
        </button>
      </div>

      <div className="max-w-2xl w-full">
        {/* Step Header */}
        <div className="text-center mb-10">
          <h1 className="text-3xl font-bold mb-3">Sign Document</h1>
          <p className="text-zinc-500">Securely hash and sign your PDF using your private key.</p>
        </div>

        {/* Main Interaction Card */}
        <div className="bg-[#121214] border border-zinc-800 rounded-3xl p-8 shadow-2xl">

          {/* STATE: IDLE */}
          {status === 'idle' && (
            <div
              onClick={() => fileInputRef.current.click()}
              className="group border-2 border-dashed border-zinc-800 hover:border-blue-500 hover:bg-blue-500/5 transition-all rounded-2xl p-16 text-center cursor-pointer"
            >
              <Upload size={48} className="mx-auto mb-4 text-zinc-700 group-hover:text-blue-500 transition-colors" />
              <p className="text-zinc-400 font-medium">Click to upload the PDF you wish to sign</p>
              <p className="text-zinc-600 text-xs mt-2">Maximum file size: 10MB</p>
            </div>
          )}

          {/* STATE: UPLOADING / HASHING */}
          {(status === 'uploading' || status === 'hashing') && (
            <div className="py-12 flex flex-col items-center text-center space-y-6">
              <div className="relative">
                <Loader2 size={64} className="text-blue-500 animate-spin" />
                <div className="absolute inset-0 flex items-center justify-center">
                  {status === 'uploading' ? <Upload size={20} /> : <Cpu size={20} />}
                </div>
              </div>
              <div>
                <h3 className="text-xl font-bold capitalize">{status}...</h3>
                <p className="text-zinc-500 text-sm mt-1">
                  {status === 'uploading' ? "Sending file to secure server" : "Computing cryptographic SHA-256 fingerprint"}
                </p>
              </div>
            </div>
          )}

          {/* STATE: READY TO SIGN */}
          {status === 'ready' && (
            <div className="space-y-8 animate-in fade-in zoom-in-95 duration-500">
              {/* Hash Display */}
              <div className="space-y-3">
                <div className="flex items-center gap-2 text-zinc-500 text-xs font-bold uppercase">
                  <Hash size={14} /> Document Fingerprint (Hash)
                </div>
                <div className="bg-black/40 border border-zinc-800 p-4 rounded-xl flex items-center justify-between">
                  <code className="text-blue-400 text-xs font-mono break-all leading-relaxed">
                    {fileData.hash}
                  </code>
                  <CheckCircle2 size={18} className="text-emerald-500 shrink-0 ml-4" />
                </div>
              </div>

              {/* Private Key Input */}
              <div className="space-y-3">
                <div className="flex items-center gap-2 text-zinc-500 text-xs font-bold uppercase">
                  <Key size={14} /> Your Private Key
                </div>
                <textarea
                  placeholder="Paste your private key (JWK) here..."
                  className="w-full bg-zinc-900/50 border border-zinc-800 rounded-xl p-4 text-sm font-mono text-zinc-300 focus:ring-2 focus:ring-blue-500 outline-none h-32 resize-none transition-all"
                  value={privateKey}
                  onChange={(e) => setPrivateKey(e.target.value)}
                />
                <p className="text-[10px] text-zinc-600 italic">
                  * Note: We never store your private key. Signing happens locally in your browser.
                </p>
              </div>

              <button onClick={() => handleSign()}
                disabled={!privateKey || duplicate || res}
                className="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-zinc-800 disabled:text-zinc-500 text-white py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/10"
              >
                <ShieldCheck size={20} />
                Sign This Document
              </button>
            </div>
          )}


          {/* Feedback Section: Success or Duplicate Warning */}
          <div className="mt-6 space-y-4">

            {/* SUCCESS MESSAGE */}
            {!duplicate && res && (
              <div className="flex items-center gap-3 bg-emerald-500/10 border border-emerald-500/20 p-4 rounded-2xl animate-in fade-in slide-in-from-bottom-2">
                <CheckCircle2 className="text-emerald-500 shrink-0" size={20} />
                <p className="text-emerald-200 text-sm font-medium">
                  {res.message || "Document signed successfully!"}
                </p>
              </div>
            )}

            {/* DUPLICATE WARNING */}
            {duplicate && (
              <div className="flex items-center gap-3 bg-amber-500/10 border border-amber-500/20 p-4 rounded-2xl animate-in fade-in slide-in-from-bottom-2">
                <ShieldCheck className="text-amber-500 shrink-0" size={20} />
                <div>
                  <p className="text-amber-200 text-sm font-bold">Already Signed</p>
                  <p className="text-amber-500/80 text-xs">
                    Your signature is already recorded in this document's audit trail.
                  </p>
                </div>
              </div>
            )}

          </div>

        </div>
      </div>

      <input
        type="file"
        ref={fileInputRef}
        className="hidden"
        accept=".pdf"
        onChange={handleFileChange}
      />
    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Signup.jsx] 
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import api from "../api/axios";
import { Eye, EyeOff } from "lucide-react";
import { useEffect } from "react";

const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

export default function Signup() {
  const [email, setEmail] = useState("");
  const [emailError, setEmailError] = useState("");
  const [password, setPassword] = useState("");
  const [username, setUsername] = useState("")
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [response, setResponse] = useState(null)
  const navigate = useNavigate();

  const copyToClipboard = async (text) => {
    try {
      await navigator.clipboard.writeText(text);
      alert("Private key is copied to clipboard!\nSave it in a safe folder.\nIt can't be generated again.");
      navigate('/login')
    } catch (err) {
      console.error("Failed to copy: ", err);
    }
  };


  const handleEmailBlur = () => {
    if (!email) return;
    if (!emailRegex.test(email)) {
      setEmailError("Enter a valid email address");
    } else {
      setEmailError("");
    }
  };

  const handleSignup = async () => {
    if (!email || !password || !username || emailError) return;

    try {
      setLoading(true);
      const res = await api.post("/auth/signup", { email, password, username });
      setResponse(res.data)
      console.log("response received::::", res);
      // const {publicKey, privateKey, obj} = res;
      // navigate('/login')
    } catch (err) {
      alert(err.response?.data?.message || "Signup failed");
    } 
    finally{
      setLoading(false)
    }
  };



  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-zinc-900 text-zinc-100 px-4">

      {/* APP TITLE */}
      <div className="mb-6 sm:mb-8 text-center">
        <h1 className="text-3xl sm:text-4xl font-bold tracking-tight">
          ðŸ“„ PDF Editor
        </h1>
        <p className="text-zinc-400 mt-1 text-sm sm:text-base">
          Edit â€¢ Sign â€¢ Translate PDFs
        </p>
      </div>

      {/* SIGNUP CARD */}
      <div
        className="
          w-full
          max-w-sm sm:max-w-md
          bg-zinc-800 border border-zinc-700
          rounded-xl p-5 sm:p-6
          shadow-lg
        "
      >
        <h2 className="text-xl sm:text-2xl font-semibold text-center mb-5 sm:mb-6">
          Create account
        </h2>

        <form
          onSubmit={(e) => {
            e.preventDefault();
            handleSignup();
          }}
          className="space-y-3 sm:space-y-4"
        >
          {/* EMAIL */}
          <div>
            <input
              type="email"
              placeholder="Email"
              value={email}
              spellCheck={false}
              autoComplete="off"
              autoCorrect="off"
              autoCapitalize="none"
              onChange={(e) => {
                const value = e.target.value;
                setEmail(value);
                if (emailRegex.test(value)) setEmailError("");
              }}
              onBlur={handleEmailBlur}
              className={`
                w-full px-3 py-2 sm:py-2.5
                rounded-md
                bg-zinc-900 border
                ${emailError ? "border-red-500" : "border-zinc-700"}
                text-zinc-100 placeholder-zinc-400
                focus:outline-none focus:ring-2
                ${emailError ? "focus:ring-red-500" : "focus:ring-indigo-500"}
                text-sm sm:text-base
              `}
            />

            {emailError && (
              <p className="text-red-400 text-xs mt-1">
                {emailError}
              </p>
            )}
          </div>

          {/* username */}
          <div>
            <input
              type="text"
              placeholder="Username"
              value={username}
              spellCheck={false}
              autoComplete="off"
              autoCorrect="off"
              autoCapitalize="none"
              onChange={(e) => {
                const value = e.target.value;
                setUsername(value);
              }}

              className={`
                w-full px-3 py-2 sm:py-2.5
                rounded-md
                bg-zinc-900 border
                border-zinc-700
                text-zinc-100 placeholder-zinc-400
                focus:outline-none focus:ring-2
                focus:ring-indigo-500
                text-sm sm:text-base
              `}
            />


          </div>

          {/* PASSWORD */}
          <div className="relative">
            <input
              type={showPassword ? "text" : "password"}
              placeholder="Password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="
                w-full px-3 py-2 sm:py-2.5 pr-10
                rounded-md
                bg-zinc-900 border border-zinc-700
                text-zinc-100 placeholder-zinc-400
                focus:outline-none focus:ring-2 focus:ring-indigo-500
                text-sm sm:text-base
              "
            />

            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="
                absolute inset-y-0 right-2
                flex items-center
                text-zinc-400 hover:text-zinc-200
                focus:outline-none
              "
              aria-label={showPassword ? "Hide password" : "Show password"}
            >
              {showPassword ? (
                <EyeOff className="w-4 h-4 sm:w-5 sm:h-5" />
              ) : (
                <Eye className="w-4 h-4 sm:w-5 sm:h-5" />
              )}
            </button>
          </div>

          <button
            type="submit"
            disabled={loading || !!emailError || response}
            className={`
              w-full py-2.5 rounded-md font-medium
              
              transition 
              text-sm sm:text-base
              ${response ? 'bg-green-600 opacity-100 opacity-100':'bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50'} 
            `}
          >
            {loading ? "Creating account..." : response?'Account Created Successfully.\nCopy private key to proceed' : "Sign up"}
          </button>
        </form>


        {response &&

          <>

            <button className="bg-blue-400 px-4 py-2 rounded-xl mt-4 cursor-pointer" onClick={() => copyToClipboard(response.privateKey)}>
              Copy your private key
            </button>

          </>

        }


        {/* BACK TO LOGIN */}
        <p className="text-xs sm:text-sm text-zinc-400 text-center mt-4">
          Already have an account?{" "}
          <span
            onClick={() => navigate("/login")}
            className="text-indigo-400 cursor-pointer hover:underline"
          >
            Log in
          </span>
        </p>
      </div>



    </div>
  );
}

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Summarize.jsx] 
import React, { useState, useRef } from 'react';
import { Upload, ArrowLeft, ShieldCheck, Cpu, Hash, Key, CheckCircle2, Loader2 } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import api from "../api/axios";

export default function SummarizeDocumentPage() {
  const [file, setFile] = useState(null);
  const [status, setStatus] = useState('idle'); // idle || uploading || hashing || ready
  const [fileData, setFileData] = useState({ hash: '', filename: '' });
  const [res, setRes] = useState(null)
  const fileInputRef = useRef(null);
  const navigate = useNavigate();

  const handleFileChange = async (e) => {
    const selectedFile = e.target.files[0];
    if (!selectedFile || selectedFile.type !== 'application/pdf') return;

    setFile(selectedFile);
    setStatus('uploading');

    const formData = new FormData();
    formData.append('file', selectedFile);

    try {
      // Step 1: Uploading
      const response = await api.post('/upload', formData, {
        headers: { 'Content-Type': 'multipart/form-data' },
        onUploadProgress: (progressEvent) => {
          if (progressEvent.progress === 1) setStatus('hashing');
        }
      });

      // Simulated delay for "Hashing" feedback so user sees the process
      setTimeout(() => {
        setFileData({
          hash: response.data.hash,
          filename: response.data.filename
        });
        setStatus('ready');
      }, 1500);

    } catch (err) {
      console.error(err);
      setStatus('idle');
      alert("Upload failed. Please try again.");
    }
  };

  const handleSummarize = async () => {
    if (!fileData.hash) return;
    setStatus('summarizing');

    try {
      const response = await api.get(`/summarize/${fileData.hash}`, {
        responseType: 'blob', // Keep this, we need binary data
      });

      // 1. EXTRACT THE FILENAME FROM THE SERVER HEADER
      // Because we added 'Access-Control-Expose-Headers' in the backend, we can read this!
      const contentDisposition = response.headers['content-disposition'];
      let fileName = `Summary_Document.pdf`; // Fallback name

      if (contentDisposition) {
        // This regex grabs whatever is inside the quotes after 'filename='
        const fileNameMatch = contentDisposition.match(/filename="(.+)"/);
        if (fileNameMatch && fileNameMatch.length === 2) {
          fileName = fileNameMatch[1];
        }
      }

      // 2. CREATE THE BLOB URL
      const blob = new Blob([response.data], { type: 'application/pdf' });
      const url = window.URL.createObjectURL(blob);

      // 3. FORCE THE BROWSER TO USE OUR NAME
      const link = document.createElement('a');
      link.href = url;

      // This is the most important line:
      link.setAttribute('download', fileName);

      document.body.appendChild(link);
      link.click();

      // 4. CLEANUP
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url);

      setStatus('ready');
      setRes(true);
    } catch (err) {
      console.error("Summarization failed:", err);
      alert("Could not generate summary.");
      setStatus('ready');
    }
  };



  return (
    <div className="min-h-screen bg-[#09090b] text-zinc-100 font-sans flex flex-col items-center py-12 px-6">

      {/* Navigation */}
      <div className="max-w-3xl w-full flex justify-start mb-12">
        <button
          onClick={() => navigate(-1)}
          className="group flex items-center gap-2 text-zinc-500 hover:text-white transition-colors"
        >
          <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform" />
          <span className="text-sm font-bold uppercase tracking-wider">Back to Dashboard</span>
        </button>
      </div>

      <div className="max-w-2xl w-full">
        {/* Step Header */}
        <div className="text-center mb-10">
          <h1 className="text-3xl font-bold mb-3">Summarize a Document</h1>
          <p className="text-zinc-500">Simply upload a pdf and get its summary in a pdf format.</p>
        </div>

        {/* Main Interaction Card */}
        <div className="bg-[#121214] border border-zinc-800 rounded-3xl p-8 shadow-2xl">

          {/* STATE: IDLE */}
          {status === 'idle' && (
            <div
              onClick={() => fileInputRef.current.click()}
              className="group border-2 border-dashed border-zinc-800 hover:border-blue-500 hover:bg-blue-500/5 transition-all rounded-2xl p-16 text-center cursor-pointer"
            >
              <Upload size={48} className="mx-auto mb-4 text-zinc-700 group-hover:text-blue-500 transition-colors" />
              <p className="text-zinc-400 font-medium">Click to upload the PDF you wish to summarize</p>
              <p className="text-zinc-600 text-xs mt-2">Maximum file size: 10MB</p>
            </div>
          )}

          {/* STATE: UPLOADING / HASHING / SUMMARIZING */}
          {(status === 'uploading' || status === 'hashing' || status === 'summarizing') && (
            <div className="py-12 flex flex-col items-center text-center space-y-6">
              <div className="relative">
                <Loader2 size={64} className="text-blue-500 animate-spin" />
                <div className="absolute inset-0 flex items-center justify-center">
                  {status === 'uploading' ? <Upload size={20} /> :
                    status === 'hashing' ? <Cpu size={20} /> :
                      <ShieldCheck size={20} className="text-blue-400" />}
                </div>
              </div>
              <div>
                <h3 className="text-xl font-bold capitalize">{status}...</h3>
                <p className="text-zinc-500 text-sm mt-1">
                  {status === 'uploading' && "Sending file to secure server"}
                  {status === 'hashing' && "Computing cryptographic SHA-256 fingerprint"}
                  {status === 'summarizing' && "AI is reading and condensing your document..."}
                </p>
              </div>
            </div>
          )}

          {/* STATE: READY TO SIGN */}
          {status === 'ready' && (
            <div className="space-y-8 animate-in fade-in zoom-in-95 duration-500">
              {/* Hash Display */}
              <div className="space-y-3">
                <div className="flex items-center gap-2 text-zinc-500 text-xs font-bold uppercase">
                  <Hash size={14} /> Document Fingerprint (Hash)
                </div>
                <div className="bg-black/40 border border-zinc-800 p-4 rounded-xl flex items-center justify-between">
                  <code className="text-blue-400 text-xs font-mono break-all leading-relaxed">
                    {fileData.hash}
                  </code>
                  <CheckCircle2 size={18} className="text-emerald-500 shrink-0 ml-4" />
                </div>
              </div>



              <button
                onClick={handleSummarize}
                disabled={status === 'summarizing' || res || status === 'uploading'}
                className="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-zinc-800 disabled:text-zinc-500 text-white py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/10"
              >
                {status === 'summarizing' ? (
                  <>
                    <Loader2 size={20} className="animate-spin" />
                    Generating PDF...
                  </>
                ) : res ? (
                  <>
                    <CheckCircle2 size={20} className="text-emerald-500 " />
                    Summary Downloaded
                  </>
                ) : (
                  <>
                    <ShieldCheck size={20} />
                    Summarize and Download
                  </>
                )}
              </button>
            </div>
          )}




        </div>
      </div>

      <input
        type="file"
        ref={fileInputRef}
        className="hidden"
        accept=".pdf"
        onChange={handleFileChange}
      />
    </div>
  );
}
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Translate.jsx] 
export default function Translate() {
  return (
    <div className="min-h-screen bg-zinc-900 text-zinc-100 flex items-center justify-center px-4">
      <div
        className="
          w-full max-w-md
          bg-zinc-800 border border-zinc-700
          rounded-xl p-6 sm:p-8
          shadow-lg text-center
        "
      >
        <div className="text-4xl mb-3">ðŸŒ</div>

        <h1 className="text-2xl sm:text-3xl font-semibold mb-2">
          Translate PDF
        </h1>

        <p className="text-zinc-400 text-sm sm:text-base mb-6">
          Translate your documents into multiple languages with ease.
        </p>

        <div className="inline-block px-4 py-1.5 rounded-full text-xs sm:text-sm font-medium bg-zinc-700 text-zinc-300">
          Coming soon 
        </div>
      </div>
    </div>
  );
}

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\pages\Watermark.jsx] 
import React, { useState, useEffect, useRef } from 'react';
import { createWatermarkImage } from '../../utils/textToImage.js';
import { processPdf } from '../../hooks/usePdfProcessor.js';
import { Upload, Type, RotateCw, Ghost, Maximize, Shield, LayoutGrid,ArrowLeft, Palette } from 'lucide-react';
import * as pdfjsLib from 'pdfjs-dist'; // import PDF.js library for client-side PDF rendering
import GlobalWorker from 'pdfjs-dist/build/pdf.worker.mjs?url'; // Vite-specific PDF worker loader import
import {useNavigate} from 'react-router-dom'
pdfjsLib.GlobalWorkerOptions.workerSrc = GlobalWorker; // tell PDF.js where the worker script is located

export default function WatermarkTool() {

  const getPdfDimensions = async (fileUrl) => {
    if (!fileUrl) return null;
    try {
      // 1. Load the document
      const loadingTask = pdfjsLib.getDocument(fileUrl);
      const pdf = await loadingTask.promise;

      // 2. Get the specific page (1-based index)
      const page = await pdf.getPage(1);

      // 3. Get the viewport at scale 1.0
      const viewport = page.getViewport({ scale: 1 });

      // Width and Height are in points (1pt = 1/72 inch)
      console.log(`Width: ${viewport.width}pt, Height: ${viewport.height}pt`);

      return {
        width: viewport.width,
        height: viewport.height,
        numPages: pdf.numPages
      };
    } catch (error) {
      console.error("Error loading PDF:", error);
    }
  };
  
  const [file, setFile] = useState(null);
  const [text, setText] = useState("text");
  const [pdfDims, setPdfDims] = useState(null);
  const [watermarkImg, setWatermarkImg] = useState(null);
  const [isProcessing, setIsProcessing] = useState(false);
  const [x, setX] = useState(0);
  const [y, setY] = useState(0);
  const navigate = useNavigate()

  const [settings, setSettings] = useState({
    color: '#808080',
    rotation: 0,
    opacity: 0.5,
    scale: 0.8,
    fontFamily: 'Times-Roman',
    position: 'center',
    flatten: false,
  });

  useEffect(() => {


    if (pdfDims) {

      if (settings.position.includes('left')) setX(10);
      else if (settings.position.includes('right')) setX(pdfDims.width - settings.scale * 65 * text.length - 10);
      else setX((pdfDims.width / 2) - (settings.scale * 65 * text.length / 2));
      if (settings.position.includes('top')) setY(pdfDims.height - settings.scale * 70 - 10);
      else if (settings.position.includes('bottom')) setY(10);
      else setY((pdfDims.height / 2) - (settings.scale * 70 / 2));
    }
  }, [file, settings, pdfDims])

  const positions = [
    'top-left', 'top-center', 'top-right',
    'middle-left', 'center', 'middle-right',
    'bottom-left', 'bottom-center', 'bottom-right'
  ];

  const canvasRef = useRef(null);
  const fileInputRef = useRef(null);

  // when `file` changes, render the first PDF page to canvas
  useEffect(() => {
    if (!file) return; // do nothing if no file selected

    const render = async () => {
      const buffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: buffer }).promise; // load PDF document
      const page = await pdf.getPage(1); // get the first page
      const viewport = page.getViewport({ scale: 1.0 }); // set a viewport scale for nicer preview
      const canvas = canvasRef.current; // obtain canvas DOM node
      const context = canvas.getContext('2d'); // get 2D drawing context
      canvas.width = viewport.width; // set canvas pixel width
      canvas.height = viewport.height; // set canvas pixel height
      await page.render({ canvasContext: context, viewport }).promise; // render the PDF page onto canvas
    };

    render();

  }, [file]);

  useEffect(() => {
    if (!file) return;

    const loadDims = async () => {
      const dims = await getPdfDimensions(URL.createObjectURL(file));
      setPdfDims(dims);
    };

    loadDims();
  }, [file]);



  useEffect(() => { // regenerate watermark image whenever text or settings change
    createWatermarkImage(text, settings).then((result) => setWatermarkImg(result)); // create the data URL and store it
  }, [text, settings]);

  const handleDownload = async () => {

    if (!file || !watermarkImg) return;

    setIsProcessing(true);

    try {
      const buffer = await file.arrayBuffer(); // read input PDF as ArrayBuffer
      const bytes = await processPdf(buffer, watermarkImg, settings, text); // embed watermark and get modified bytes
      const blob = new Blob([bytes], { type: 'application/pdf' }); // create a blob from bytes
      const link = document.createElement('a'); // create a temporary anchor
      link.href = URL.createObjectURL(blob); // create object URL for the blob
      link.download = `watermarked.pdf`; // set suggested filename
      link.click(); // trigger download
    } catch (e) { console.error(e); } // log any error
    setIsProcessing(false);
  };

  return (

    <div className="flex h-screen bg-[#09090b] text-zinc-100 font-sans overflow-hidden"> {/* top-level layout container */}




      {/* SIDEBAR */}
      <aside className="w-80 bg-[#121214] border-r border-zinc-800 p-6 flex flex-col space-y-6 shadow-2xl z-20 h-full">

{/* SIDEBAR HEADER: Button + Title */}
<div className="flex items-center gap-4  pr-6">
  <button
    onClick={() => navigate('/dashboard', { replace: true })}
    className="
      group
      flex items-center justify-center
      w-10 h-10 
      shrink-0
      rounded-full 
      bg-zinc-900 
      border border-zinc-800 
      text-zinc-400
      transition-all duration-200 
      hover:bg-zinc-800 hover:text-blue-400 hover:border-blue-500/50
      focus:outline-none focus:ring-2 focus:ring-blue-500/40
      active:scale-95
      shadow-lg
    "
    title="Back to Dashboard"
  >
    <ArrowLeft size={20} className="transition-transform group-hover:-translate-x-0.5" />
  </button>

  <h1 className="text-xl font-bold tracking-tight text-zinc-100 whitespace-nowrap">
    Watermark Editor
  </h1>
</div>

      <hr className='text-[#808080]' />
        <div className="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8">

          {/* group of control blocks */}
          <div className="space-y-4">

            {/* text input block */}
            <div className="space-y-2">
              <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2"><Type size={14} /> Text</label> {/* label with icon */}
              <input className="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-2 outline-none focus:ring-1 focus:ring-blue-500" value={text} onChange={(e) => setText(e.target.value)} />
            </div>

            {/* color input */}
            <div className="space-y-3">
              <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2">
                <Palette size={14} /> Watermark Color
              </label>

              {/* Professional Swatches */}
              <div className="flex flex-wrap gap-2 mb-2">
                {[
                  { name: 'Stamp Red', hex: '#ef4444' },
                  { name: 'Security Blue', hex: '#3b82f6' },
                  { name: 'Formal Black', hex: '#18181b' },
                  { name: 'Soft Slate', hex: '#64748b' },
                ].map((preset) => (
                  <button
                    key={preset.hex}
                    onClick={() => setSettings({ ...settings, color: preset.hex })}
                    className={`w-6 h-6 ring-2 ring-zinc-700 rounded-full border-2 transition-transform hover:scale-110 ${settings.color === preset.hex ? 'border-white scale-110' : 'border-transparent'
                      }`}
                    style={{ backgroundColor: preset.hex }}
                    title={preset.name}
                  />
                ))}
              </div>

              {/* Custom Color Control */}
              <div className="flex items-center gap-3 bg-zinc-900 p-2 rounded-xl border border-zinc-800 group hover:border-zinc-700 transition-colors">
                <div className="relative w-8 h-8 rounded-lg overflow-hidden border border-zinc-700">
                  <input
                    type="color"
                    className="absolute -inset-2 w-12 h-12 bg-transparent border-none cursor-pointer"
                    value={settings.color}
                    onChange={(e) => setSettings({ ...settings, color: e.target.value })}
                  />
                </div>
                <div className="flex flex-col">
                  <span className="text-[10px] text-zinc-500 font-bold uppercase leading-none mb-1">Custom Hex</span>
                  <span className="text-sm font-mono uppercase text-zinc-200">{settings.color}</span>
                </div>
              </div>
            </div>

            {/* Rotate watermark */}
            <div className="space-y-4">
              <div className="flex justify-between items-end">
                <div className="space-y-1">
                  <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2">
                    <RotateCw size={14} /> Orientation
                  </label>
                  <p className="text-[10px] text-zinc-600 font-medium">Tilt your watermark</p>
                </div>
                <span className="text-sm font-mono font-bold text-blue-500 bg-blue-500/10 px-2 py-0.5 rounded">
                  {settings.rotation}Â°
                </span>
              </div>

              {/* Quick Snap Angles */}
              <div className="flex justify-between gap-1">
                {[0, 45, 90, -45].map((angle) => (
                  <button
                    key={angle}
                    onClick={() => setSettings({ ...settings, rotation: angle })}
                    className={`flex-1 py-1.5 text-[10px] font-bold rounded-md border transition-all ${settings.rotation === angle
                      ? 'bg-zinc-800 border-zinc-600 text-zinc-100 shadow-sm'
                      : 'bg-transparent border-zinc-800 text-zinc-500 hover:border-zinc-700'
                      }`}
                  >
                    {angle === 0 ? 'Flat' : `${angle}Â°`}
                  </button>
                ))}
              </div>

              {/* Visual Slider */}
              <div className="relative flex items-center group">
                <input
                  type="range"
                  min="-180"
                  max="180"
                  className="w-full h-1.5 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-blue-600"
                  value={settings.rotation}
                  onChange={(e) => setSettings({ ...settings, rotation: parseInt(e.target.value) })}
                />

                {/* Visual Center Notch */}
                <div className="absolute left-1/2 -bottom-1 w-px h-2 bg-zinc-700 -translate-x-1/2 pointer-events-none" />
              </div>

              {/* Reset Button (only shows when not at 0) */}
              {settings.rotation !== 0 && (
                <button
                  onClick={() => setSettings({ ...settings, rotation: 0 })}
                  className="text-[10px] font-bold text-zinc-500 hover:text-blue-500 transition-colors flex items-center gap-1 mx-auto"
                >
                  Reset to Horizontal
                </button>
              )}
            </div>

            {/* Resize Watermark */}
            <div className="space-y-4">
              <div className="flex justify-between items-end">
                <div className="space-y-1">
                  <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2">
                    <Maximize size={14} /> Watermark Size
                  </label>
                </div>
                <span className="text-sm font-mono font-bold text-blue-500 bg-blue-500/10 px-2 py-0.5 rounded">
                  {Math.round(settings.scale * 100)}%
                </span>
              </div>

              {/* Semantic Presets */}
              <div className="flex justify-between gap-1">
                {[
                  { label: 'Small', val: 0.15 },
                  { label: 'Standard', val: 0.35 },
                  { label: 'Large', val: 0.65 },
                  { label: 'Full', val: 0.90 }
                ].map((preset) => (
                  <button
                    key={preset.label}
                    onClick={() => setSettings({ ...settings, scale: preset.val })}
                    className={`flex-1 py-1.5 text-[10px] font-bold rounded-md border transition-all ${Math.abs(settings.scale - preset.val) < 0.01
                      ? 'bg-zinc-800 border-zinc-600 text-zinc-100'
                      : 'bg-transparent border-zinc-800 text-zinc-500 hover:border-zinc-700'
                      }`}
                  >
                    {preset.label}
                  </button>
                ))}
              </div>

              {/* Precision Slider */}
              <div className="space-y-2">
                <input
                  type="range"
                  min="0.05"
                  max="1"
                  step="0.01"
                  className="w-full h-1.5 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-blue-600"
                  value={settings.scale}
                  onChange={(e) => setSettings({ ...settings, scale: parseFloat(e.target.value) })}
                />
                <div className="flex justify-between text-[9px] text-zinc-600 font-bold px-1 uppercase tracking-tighter">
                  <span>Tiny</span>
                  <span>Cover Page</span>
                </div>
              </div>
            </div>

            {/* Set Opacity */}
            <div className="space-y-4">
              <div className="flex justify-between items-end">
                <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2">
                  <Ghost size={14} /> Transparency
                </label>
                <span className="text-sm font-mono font-bold text-blue-500 bg-blue-500/10 px-2 py-0.5 rounded">
                  {Math.round(settings.opacity * 100)}%
                </span>
              </div>

              <div className="relative flex items-center bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                {/* Corrected: 0% is Ghost, 100% is Solid */}
                <span className="text-[10px] font-bold text-zinc-600 mr-3 uppercase tracking-tighter">Ghost</span>

                <input
                  type="range"
                  min="0.05"
                  max="1"
                  step="0.05"
                  className="w-full h-1.5 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-blue-600"
                  value={settings.opacity}
                  onChange={(e) => setSettings({ ...settings, opacity: parseFloat(e.target.value) })}
                />

                <span className="text-[10px] font-bold text-zinc-600 ml-3 uppercase tracking-tighter">Solid</span>
              </div>


            </div>

            {/* Select Position */}
            <div className="space-y-3">
              <div className="flex justify-between items-center px-1">
                <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2">
                  <LayoutGrid size={14} /> Anchor
                </label>
                <span className="text-[10px] font-mono text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded-full uppercase tracking-tighter">
                  {settings.position.replace('-', ' ')}
                </span>
              </div>

              {/* Added max-w-[160px] and mx-auto to tighten the width */}
              <div className="grid grid-cols-3 gap-1.5 bg-[#09090b] p-1.5 rounded-xl border border-zinc-800 shadow-inner max-w-[160px] mx-auto">
                {positions.map((pos) => (
                  <button
                    key={pos}
                    onClick={() => setSettings({ ...settings, position: pos })}
                    className={`h-7 rounded-md border flex items-center justify-center transition-all duration-200 ${settings.position === pos
                      ? 'bg-blue-600/20 border-blue-500 shadow-[0_0_12px_rgba(59,130,246,0.15)]'
                      : 'bg-zinc-900 border-zinc-800 hover:border-zinc-700'
                      }`}
                  >
                    <div className={`w-1.5 h-1.5 rounded-full transition-all ${settings.position === pos
                      ? 'bg-blue-400 scale-125 shadow-[0_0_5px_#3b82f6]'
                      : 'bg-zinc-700'
                      }`} />
                  </button>
                ))}
              </div>
            </div>

            {/* Font Selction */}
            <div className="space-y-3">
              <div className="flex justify-between items-center px-1">
                <label className="text-xs font-bold text-zinc-500 uppercase flex items-center gap-2">
                  <Type size={14} /> Typography
                </label>
                <span className="text-[10px] font-mono text-zinc-500 bg-zinc-800/50 px-2 py-0.5 rounded">
                  {settings.fontFamily}
                </span>
              </div>

              <div className="grid grid-cols-2 gap-2">
                {[
                  { label: 'Ag', value: 'Times-Roman', name: 'Serif' },
                  { label: 'Ag', value: 'Helvetica', name: 'Sans' },
                  { label: 'Ag', value: 'Courier', name: 'Mono' },
                  { label: 'Ag', value: 'comic sans ms', name: 'comic' },
                ].map((font) => (
                  <button
                    key={font.value}
                    onClick={() => setSettings({ ...settings, fontFamily: font.value })}
                    className={`flex items-center gap-3 p-2 rounded-xl border transition-all duration-200 ${settings.fontFamily === font.value
                      ? 'bg-blue-600/10 border-blue-500 shadow-[0_0_12px_rgba(59,130,246,0.1)]'
                      : 'bg-[#09090b] border-zinc-800 hover:border-zinc-700'
                      }`}
                  >
                    {/* Visual Preview Square */}
                    <div
                      className={`w-8 h-8 rounded-lg flex items-center justify-center text-lg shadow-sm ${settings.fontFamily === font.value ? 'bg-blue-500 text-white' : 'bg-zinc-800 text-zinc-400'
                        }`}
                      style={{
                        fontFamily: font.value === 'comic' ? 'comic sans ms' : font.value === 'Times-Roman' || font.value === 'Times-BoldItalic' ? 'serif' :
                          font.value === 'Courier' ? 'monospace' : 'sans-serif',
                        fontStyle: font.value.includes('Italic') ? 'italic' : 'normal',
                        fontWeight: font.value.includes('Bold') ? 'bold' : 'normal'
                      }}
                    >
                      {font.label}
                    </div>

                    <span className={`text-[13px] font-bold  tracking-tight ${settings.fontFamily === font.value ? 'text-blue-400' : 'text-zinc-500'}`}
                      style={{
                        fontFamily: font.value === 'comic' ? 'comic sans ms' : font.value === 'Times-Roman' || font.value === 'Times-BoldItalic' ? 'serif' :
                          font.value === 'Courier' ? 'monospace' : 'sans-serif',
                        fontStyle: font.value.includes('Italic') ? 'italic' : 'normal',
                        fontWeight: font.value.includes('Bold') ? 'bold' : 'normal'
                      }}>
                      {font.name}
                    </span>
                  </button>
                ))}
              </div>
            </div>

            {/* Flatten PDF */}
            <div className="space-y-4 pt-2 border-t border-zinc-800/50">
              <div className={`flex items-center justify-between p-3 rounded-xl border transition-all ${settings.flatten ? 'bg-blue-600/5 border-blue-500/50' : 'bg-zinc-900/30 border-zinc-800'
                }`}>
                <div className="space-y-0.5">
                  <label className="text-xs font-bold text-zinc-200 flex items-center gap-2 uppercase tracking-wider">
                    <Shield size={14} className={settings.flatten ? "text-blue-400" : "text-zinc-500"} />
                    Copy Protection
                  </label>
                  <p className="text-[10px] text-zinc-500 leading-tight">Add gibberish layer to pollute block selection.</p>
                </div>

                <button
                  onClick={() => setSettings({ ...settings, flatten: !settings.flatten })}
                  className={`w-9 h-5 rounded-full transition-colors relative ${settings.flatten ? 'bg-blue-600' : 'bg-zinc-700'
                    }`}
                >
                  <div className={`absolute top-1 w-3 h-3 bg-white rounded-full transition-all shadow-sm ${settings.flatten ? 'left-5' : 'left-1'
                    }`} />
                </button>
              </div>
            </div>


          </div>

        </div>

        <button onClick={handleDownload} disabled={!file || isProcessing} className="w-full mt-auto bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-bold transition-all disabled:bg-zinc-800">
          {isProcessing ? "Embedding..." : "Download PDF"}
        </button>
      </aside>


      <main className="flex-1 bg-[#09090b] flex items-center justify-center p-10 overflow-auto">

        {file ? (
          <div className={`relative shadow-2xl bg-white border-3 border-blue-800 overflow-hidden`} >

            {/* container for PDF preview with watermark overlay */}
            <canvas ref={canvasRef} />

            {watermarkImg && file && pdfDims && (
              <div className={`absolute pointer-events-none flex items-center`} style={{ height: `${settings.scale * 70}px`, width: `${settings.scale * 65 * text.length}px`, left: `${x}px`, top: `${pdfDims.height - y - settings.scale * 70}px`, transform: `rotate(${-settings.rotation}deg)` }}>
                <img
                  src={watermarkImg}
                  style={{
                    width: `${settings.scale * 65 * text.length}px`,
                    height: `${settings.scale * 70}px`,
                    // Converting PDF Bottom-Left to CSS Top-Left:
                    opacity: settings.opacity,
                    pointerEvents: 'none',
                    zIndex: 10,
                  }}
                />
              </div>
            )}

          </div>
        ) : (

          //input pdf upload area
          <div onClick={() => fileInputRef.current.click()} className="border-2 border-dashed border-zinc-800 p-20 rounded-3xl cursor-pointer hover:border-blue-500 transition-all text-zinc-500 text-center">
            <Upload size={48} className="mx-auto mb-4 text-zinc-700" />
            <p>Click to upload PDF</p>
          </div>
        )}
      </main>

      <input type="file" ref={fileInputRef} className="hidden" accept=".pdf" onChange={(e) => setFile(e.target.files[0])} /> {/* hidden file input used to trigger file selection */}
    </div>
  );
}

//here 
[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\routes\ProtectedRoute.jsx] 
import { Navigate } from "react-router-dom";

export default function ProtectedRoute({ children }) {
  const token = localStorage.getItem("token");
  return token ? children : <Navigate to="/login" replace />;
}

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\src\routes\PublicRoute.jsx] 
import { Navigate } from "react-router-dom";

export default function PublicRoute({ children }) {
  const token = localStorage.getItem("token");

  if (token) {
    return <Navigate to="/dashboard" replace />;
  }

  return children;
}

[FILE: C:\Users\gaurav.jain\Desktop\pdf-editor\frontend\utils\textToImage.js] 
export const createWatermarkImage = (text, settings) => {

  return new Promise((resolve) => {

    const canvas = document.createElement('canvas'); // create an offscreen canvas element
    const ctx = canvas.getContext('2d'); // get the 2D rendering context from the canvas

    canvas.width = settings.scale * 65 * text.length;
    canvas.height = settings.scale * 70;

    // clear the entire canvas to a blank state
    // params - x, y, width, height
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // drawing the boundary here.
    // ctx.strokeStyle = settings.color || '#808080'; 
    // ctx.lineWidth = 5;
    // Draw rectangle at (0,0) with full width/height
    // ctx.strokeRect(0, 0, canvas.width, canvas.height);

    // Style settings from UI
    ctx.fillStyle = settings.color || '#808080'; // set text fill color from settings or fallback
    ctx.font = `bold ${settings.scale * 100}px ${settings.fontFamily}`; // set font weight, size, and family from settings
    ctx.textAlign = 'center'; // horizontally center text when drawing
    ctx.textBaseline = 'middle'; // vertically center text when drawing

    ctx.fillText(text, canvas.width / 2, canvas.height / 2); // draw the watermark text centered on the canvas
    console.log('new image generated')
    resolve(canvas.toDataURL('image/png')); // convert canvas to PNG data URL and resolve the Promise with it
  });
};
